<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Veljko Petrović">
  <title>Domen Problema</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/theme/night.css" id="theme">
  <link rel="stylesheet" href="slides.css"/>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Domen Problema</h1>
  <p class="author">Veljko Petrović</p>
  <p class="date">Novembar, 2022</p>
</section>

<section>
<section id="zašto-koristimo-hpc" class="title-slide slide level1">
<h1>Zašto koristimo HPC?</h1>
<p>Tipični problemi hpc-a</p>
</section>
<section id="hpc-kao-priznanje-neuspeha" class="slide level2">
<h2>HPC kao priznanje neuspeha</h2>
<ul>
<li>Na jedan veoma stvaran način, HPC je znak da smo se predali.</li>
<li>Reformulacija problema nije radila.</li>
<li>Lukavi algoritmi nisu radili.</li>
<li>Sve što nam je ostalo jeste da napadnemo problem sa mnogo više resursa nego što je to normalno dostupno.</li>
<li>HPC je, tako, zadnja linija odbrane kada se rešava nekakav problem.</li>
</ul>
</section>
<section id="hpc-i-ekonomija" class="slide level2">
<h2>HPC i ekonomija</h2>
<ul>
<li>HPC je takođe ograničen neočekivanim ekonomskim faktorima.</li>
<li>Vi možete lični računar namestiti da radi šta god želite: ako hoćete da uposlite 100% CPU-a generišući svetove kroz Dwarf Fortress niko se neće buniti. U najgorem slušaju trošite malo dodatne struje.</li>
<li>HPC klasteri i super-računari su drugačiji: ozbiljne instalacije imaju troškove izvršavanja koji znače da se svaki minut mora naplaćivati.</li>
<li>Stoga HPC se uglavnom koristi ili za projekte koje su interesantni vladama ili velikim kompanijama.</li>
</ul>
</section>
<section id="neke-popularne-primene" class="slide level2">
<h2>Neke popularne primene</h2>
<ul>
<li>Kriptanaliza</li>
<li>Naučna simulacija</li>
<li>Simulacija fluida</li>
<li>Simulacija plazme</li>
<li>Simulacija klime</li>
<li>Seizmološki modeli</li>
<li>Statistička analiza ogromnih skupova podataka</li>
<li>Problemi mašinskog učenja</li>
</ul>
</section>
<section id="ograničenje-kursa" class="slide level2">
<h2>Ograničenje kursa</h2>
<ul>
<li>Ovde mi prelazimo ove primene samo ovlaš zato što, fundamentalno, svrha za koju se HPC primenjuje nije odgovornost HPC inženjera. To je odgovornost domenskog eksperta. HPC se bavi time da su resursi za proračun dostupni.</li>
<li>Kao deo ovog kursa od vas će se tražiti da napišete seminarski rad o nekoj primeni zato što je zgodno da znate, makar okvirno, kako izgleda pravi problem ne bi li bili sposobniji da projektujete rešenja koja taj problem i njemu slične rešavaju.</li>
</ul>
</section>
<section id="kriptanaliza" class="slide level2">
<h2>Kriptanaliza</h2>
<ul>
<li>Prvobitna primena računara (te i, po definicji, HPC-a).</li>
<li>Cela svrha kriptografije jeste da ne ostavi nikakav brz način da se do podataka dođe bez nekog ključnog elementa (ključa, tipično).</li>
<li>Kriptanaliza, idealno, razbije algoritam za enkripciju tako da to ne važi.</li>
<li>Danas su kriptografi mnogo veštiji nego nekada i potpuno razbijeni algoritmi su retki. Alternativa jeste da se postigne parcijalno oslabljivanje gde se količina nagađanja i proračuna smanji donekle tako da (možda?) dođe u domet najbržih super-računara.</li>
<li>Možete biti sigurni da negde u podrumima NSA zuje računari koji se bave baš ovim poslom.</li>
</ul>
</section>
<section id="kriptanalizamogući-problem" class="slide level2">
<h2>Kriptanaliza—mogući problem</h2>
<ul>
<li>Istražiti algoritam tipa opšteg sita polja brojeva (general number field sieve—GNFS) i koristiti ga za faktorisanje poluprostih brojeva.</li>
<li>Poluprost (semiprime) je broj sa dva ne-trivijalna prosta faktora, npr. 2701 koji je 37 * 73.</li>
<li>Ovo se onda lako može koristiti za razbijanje RSA enkripcije, tj. za ekstrakciju privatnog ključa iz javnog ključa.</li>
<li>GNFS referentna implementacija je: https://sourceforge.net/projects/msieve/</li>
</ul>
</section>
<section id="naučna-simulacija" class="slide level2">
<h2>Naučna simulacija</h2>
<ul>
<li>Posmatrano sa veoma visokog nivoa apstrakcije, naučne simulacije su tipično (mada ne nužno) simulacije nekakvog fizičkog sistema koji je takav da je nemoguće dobiti rešenje zatvorene forme no je neophodno raditi aproksimaciju i diskretizaciju.</li>
<li>Recimo u komputacionoj dinamici fluida prostor se deli na komade (ćelije) i specijalizovana verzija Navier-Stokes jednačina se rešava za svaki taj komad u svakom kvantu vremena formirajući rezultat.</li>
</ul>
</section>
<section id="primer-naučne-simulacijeproblem-n-tela" class="slide level2">
<h2>Primer naučne simulacije—Problem n tela</h2>
<ul>
<li>Problem n-tela je jedan od najpoznatijih i definitivno najstarijih problema u matematičkoj fizici.</li>
<li>Imaju razne pod-formulacije koje sve objedinjuje sistem od n tela koji interaguju pod nekakvom silom no mi se ovde fokusiramo na vrlo jednostavnu, Njutnovsku verziju:</li>
<li>Ako imamo n tela sa masama m0…n i pozicijama r0….n koje variraju u odnosu na vreme t, kako će ta tela da se ponašaju pod efektom gravitacije.</li>
<li>(Dalji deo predavanja delimično baziran na materijalima Dr Rejmoda J. Spiterija za njegov kurs Parallel Programming for Scientific Computing držan 2014 u Univerzitetu Saskačevana, a koji su bazirani na materijalima sa Berklija.) https://www.cs.usask.ca/~spiteri/CMPT851/notes/nBody.pdf</li>
</ul>
</section>
<section id="formulacija-problema-ulazi" class="slide level2">
<h2>Formulacija problema — ulazi</h2>
<ul>
<li>U sistem ulaze:
<ul>
<li>Početne pozicije svih tela</li>
<li>Početne brzine svih tela</li>
<li>Mase svih tela</li>
<li>Vremenski parametri koji uključuju:
<ul>
<li>Koliko traje simulacija</li>
<li>Pod kojim koracima želimo izlaz</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="formulacija-problemaizlazli" class="slide level2">
<h2>Formulacija problema—izlazli</h2>
<ul>
<li>Iz sistema izlazi:
<ul>
<li>Pozicija svakog tela za vremenske korake</li>
<li>Brzina svakog tela za vremenske korake</li>
</ul></li>
</ul>
</section>
<section id="formulacija-problemapretpostavke" class="slide level2">
<h2>Formulacija problema—pretpostavke</h2>
<ul>
<li>Važe Njutnovi zakoni kretanja i gravitacije</li>
<li>Svi objekti su tačkaste mase</li>
<li>Svi objekti se mogu preklapati, tj. sudare modeliramo kao dva objekta na istom mestu.</li>
</ul>
</section>
<section id="notacija" class="slide level2">
<h2>Notacija</h2>
<ul>
<li>Neka je <span class="math inline">\(n\)</span> broj tela (čestica)</li>
<li>Neka su mase <span class="math inline">\(m_i\)</span> sa <span class="math inline">\(i\)</span> od <span class="math inline">\(0\)</span> do <span class="math inline">\(n-1\)</span>.</li>
<li>Neka su pozicije <span class="math inline">\(\vec{r_i}(t)\)</span> sa <span class="math inline">\(i\)</span> od <span class="math inline">\(0\)</span> do <span class="math inline">\(n-1\)</span>, vektori.</li>
</ul>
</section>
<section id="fizika" class="slide level2">
<h2>Fizika</h2>
<p>Onda je sila kojom čestica <span class="math inline">\(j\)</span> deluje na česticu <span class="math inline">\(i\)</span> iznosi: <span class="math display">\[
\vec{f_{i,j}}(t) = -\frac{Gm_im_j}{{\lVert \vec{r_i}(t) - \vec{r_j}(t) \rVert}^3}(\vec{r_i}(t) - \vec{r_j}(t))
\]</span> Gde je: <span class="math display">\[
G = 6.673 \times 10^{-11} m/(kg \cdot s^2)
\]</span></p>
</section>
<section id="fizika-1" class="slide level2">
<h2>Fizika</h2>
<p>Ukupna sila na česticu će onda biti <span class="math display">\[
\vec{F_i}(t) = \sum^{n-1}_{\substack{j=0 \\ i \ne i}}\vec{f_{ij}}(t)
\]</span></p>
</section>
<section id="fizika-2" class="slide level2">
<h2>Fizika</h2>
<p>Što možemo da proširimo u: <span class="math display">\[
\vec{f_{i,j}}(t) =  \sum^{n-1}_{\substack{j=0 \\ i \ne i}} -\frac{Gm_im_j}{{\lVert \vec{r_i}(t) - \vec{r_j}(t) \rVert}^3}(\vec{r_i}(t) - \vec{r_j}(t))
\]</span></p>
</section>
<section id="fizika-3" class="slide level2">
<h2>Fizika</h2>
<p>A ovo se pojednostavljuje u: <span class="math display">\[
\vec{f_{i,j}}(t) =  -Gm_i\sum^{n-1}_{\substack{j=0 \\ i \ne i}} \frac{m_j}{{\lVert \vec{r_i}(t) - \vec{r_j}(t) \rVert}^3}(\vec{r_i}(t) - \vec{r_j}(t))
\]</span></p>
</section>
<section id="fizika-4" class="slide level2">
<h2>Fizika</h2>
<p>Koristeći Njutnov drugi zakon u vektorskoj formulaciji imamo onda: <span class="math display">\[
\vec{F_i}(t) = m_i\ddot{\vec{r_i}(t)}, i = 0, 1, ... n - 1
\]</span></p>
</section>
<section id="fizika-5" class="slide level2">
<h2>Fizika</h2>
<p>Ovo nas na kraju dovede do sistema prostih diferencijalnih jednačina drugog reda oblika: <span class="math display">\[
\ddot{\vec{r_i}(t)} = -G\sum^{n-1}_{\substack{j=0 \\ i \ne i}} \frac{m_j}{{\lVert \vec{r_i}(t) - \vec{r_j}(t) \rVert}^3}(\vec{r_i}(t) - \vec{r_j}(t))
\]</span></p>
</section>
<section id="neke-olakšice" class="slide level2">
<h2>Neke olakšice</h2>
<ul>
<li>Da bi nam život bio lakši, u ovoj ‘igračka’ implementaciji radimo sa sledećim ograničenjima:
<ul>
<li>Prostor je 2D i nije particionisan.</li>
<li>Jednačinu integralimo koristeći maksimalno jednostavnu Ojlerovu numeričku metodu koja gleda unapred.</li>
<li>Vremenski korak koji koristimo je konstantan.</li>
</ul></li>
<li>Ova ograničenja čine ovo vrlo lošim algoritmom za n-tela, ali vrlo ilustrativnim.</li>
<li>Moguć zadatak: Istraživanje metoda za povećanje preciznosti i brzine modela n tela što uključuje hijerarhijsko particionisanje prostora, dinamičko zaokruživanje na nulu, i adaptivni korak vremena.</li>
</ul>
</section>
<section id="ojlerova-metoda" class="slide level2">
<h2>Ojlerova metoda?</h2>
<ul>
<li>Prva i komično najprostija metoda za numeričku integraciju diferencijalnih jednačina.</li>
<li>Poznata je i kao najprostija Runge-Kuta metoda.</li>
<li>Esencijalno, aproksimiramo nepoznatu krivu datu kroz njen izvod tako što je podelimo na male deliće (koraci) u kojima se pretvaramo da je kriva linearna.</li>
</ul>
</section>
<section id="ojlerova-metoda-1" class="slide level2">
<h2>Ojlerova metoda?</h2>
<p><img data-src="img/2022-12-12-13-08-46.png" /></p>
</section>
<section id="ojlerova-metoda-2" class="slide level2">
<h2>Ojlerova metoda?</h2>
<ul>
<li>Ovo nije osobito dobar način da se integrali diferencijalna jednačina.</li>
<li>Može li bolje?
<ul>
<li>Nego šta.</li>
<li>Ali to je više posao za specijalistički kod, o kome više kasnije.</li>
</ul></li>
</ul>
</section>
<section id="gruba-struktura-algoritma" class="slide level2">
<h2>Gruba struktura algoritma</h2>
<p><img data-src="img/2022-12-05-15-30-43.png" /></p>
</section>
<section id="gruba-struktura-proračuna-fit" class="slide level2">
<h2>Gruba struktura proračuna Fi(t)</h2>
<p><img data-src="img/2022-12-05-15-30-55.png" /></p>
</section>
<section id="malo-ubrzanje" class="slide level2">
<h2>Malo ubrzanje</h2>
<ul>
<li>Postoji fundamentalna simetrija u problemu kojom možemo da da prepolovimo broj proračuna</li>
<li>Njutnov treći zakon znači da <span class="math inline">\(\vec{f_{i,j}}(t) = -\vec{f_{j,i}}(t)\)</span></li>
<li>Ako znamo jednu, znamo i drugu, samo treba obrnuti znak.</li>
<li>Kako da to uradimo lako?</li>
<li>Najbolje je posmatrati matricu sile</li>
</ul>
</section>
<section id="matrica-sile" class="slide level2">
<h2>Matrica sile</h2>
<span class="math display">\[\begin{bmatrix}
0 &amp; f_{0,1} &amp; f_{0,2} &amp; \cdots &amp; f_{0,n-1}\\ 
-f_{0,1} &amp; 0 &amp; f_{1,2} &amp; \cdots &amp; f_{1,n-1} \\ 
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
-f_{0,n-1} &amp; -f_{1,n-1} &amp; -f_{2,n-1} &amp; \cdots &amp; 0
\end{bmatrix}\]</span>
</section>
<section id="matrica-sile-1" class="slide level2">
<h2>Matrica sile</h2>
<ul>
<li>Sad sve što treba da uradimo jeste da pravimo petlju samo nad gornjim/donjim trouglom matrice</li>
</ul>
</section>
<section id="redukovani-algoritam" class="slide level2">
<h2>Redukovani algoritam</h2>
<p><img data-src="img/2022-12-05-15-36-11.png" /></p>
</section>
<section id="dalji-razvoj-algoritma" class="slide level2">
<h2>Dalji razvoj algoritma</h2>
<p>Kada imamo ukupne sile koje deluju na neku česticu, onda možemo da kažemo: <span class="math display">\[
a_i(t) = \ddot{\vec{r_i}}(t) = \frac{\vec{F_i}(t)}{m_i}
\]</span> Ovo je naša diferencijalna jednačina koju hoćemo da integrišemo (dvaput) da bi dobili pomeraj tokom vremena.</p>
</section>
<section id="pojednostavljenje-jednačine" class="slide level2">
<h2>Pojednostavljenje jednačine</h2>
<p>Imamo Ojlerov metod koji smo pominjali ranije, ali on je za diferencijalne jednačine prvog reda oblika: <span class="math inline">\(\dot{\vec{y}}(t) = \vec{f}(t, \vec{y}), \vec{y}(0) = \vec{y_0}, t &gt; 0\)</span>.</p>
</section>
<section id="pojednostavljenje-jednačine-1" class="slide level2">
<h2>Pojednostavljenje jednačine</h2>
<ul>
<li>Mi imamo jednačinu drugog reda.</li>
<li>Srećom, to se može popraviti: uvek je moguće pretvoriti jednačinu <span class="math inline">\(m\)</span>-tog reda u <span class="math inline">\(m\)</span> jednačina prvog reda tako što se funkcija i njeni izvodi do <span class="math inline">\(m-1\)</span> tretiraju kao nepoznate.</li>
</ul>
</section>
<section id="pojednostavljenje-jednačine-2" class="slide level2">
<h2>Pojednostavljenje jednačine</h2>
<p><span class="math display">\[
\dot{\vec{r_i}}(t) = \vec{v_i}(t)
\]</span> <span class="math display">\[
\dot{\vec{v_i}}(t) = \frac{\vec{F_i}(t)}{m_i}  \\
\]</span> <span class="math display">\[
\vec{r_i}(0) = \vec{r_{i,0}}, \vec{v_i}(0) = \vec{v_{i,0}} \\
\]</span> <span class="math display">\[
i = 0, 1, 2, \dots, n-1
\]</span></p>
</section>
<section id="ojlerov-metod-i-pojedostavljena-jednačina" class="slide level2">
<h2>Ojlerov metod i pojedostavljena jednačina</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>r<span class="op">[</span>i<span class="op">].</span>x <span class="op">+=</span> dt<span class="op">*</span>v<span class="op">[</span>i<span class="op">].</span>x<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>r<span class="op">[</span>i<span class="op">].</span>y <span class="op">+=</span> dt<span class="op">*</span>v<span class="op">[</span>i<span class="op">].</span>y<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>v<span class="op">[</span>i<span class="op">].</span>x <span class="op">+=</span> dt<span class="op">*</span>f<span class="op">[</span>i<span class="op">].</span>x<span class="op">/</span>m<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>v<span class="op">[</span>i<span class="op">].</span>y <span class="op">+=</span> dt<span class="op">*</span>f<span class="op">[</span>i<span class="op">].</span>y<span class="op">/</span>m<span class="op">[</span>i<span class="op">];</span></span></code></pre></div>
</section></section>
<section>
<section id="referentna-implementacija-rešenja-problema-n-tela" class="title-slide slide level1">
<h1>Referentna implementacija rešenja problema n-tela</h1>
<p>Osnovne implementacije</p>
</section>
<section id="uvodni-komentari" class="slide level2">
<h2>Uvodni komentari</h2>
<ul>
<li>Slede par selekcija iz koda koji implementira rešenja problema n tela u različitim kontekstima</li>
<li>Kod je adaptiran iz koda Univerziteta u Berkliju, i čiji je prvobitni autor Džejms Demel</li>
</ul>
</section>
<section id="osnovna-forma-algoritma" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;timer.h&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DIM 2  </span><span class="co">/* Two-dimensional system */</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define X 0    </span><span class="co">/* x-coordinate subscript */</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-1" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define Y 1    </span><span class="co">/* y-coordinate subscript */</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">double</span> G <span class="op">=</span> <span class="fl">6.673e-11</span><span class="op">;</span>  <span class="co">/* Gravitational constant. */</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                             <span class="co">/* Units are m^3/(kg*s^2)  */</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">// const double G = 0.1;  /* Gravitational constant. */</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                       <span class="co">/* Units are m^3/(kg*s^2)  */</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-2" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">double</span> vect_t<span class="op">[</span>DIM<span class="op">];</span>  <span class="co">/* Vector type for position, etc. */</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> particle_s <span class="op">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> m<span class="op">;</span>  <span class="co">/* Mass     */</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>   vect_t s<span class="op">;</span>  <span class="co">/* Position */</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>   vect_t v<span class="op">;</span>  <span class="co">/* Velocity */</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-3" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">);</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">);</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-4" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_energy<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span><span class="op">*</span> kin_en_p<span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> pot_en_p<span class="op">);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-5" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*--------------------------------------------------------------------*/</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n<span class="op">;</span>                      <span class="co">/* Number of particles        */</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n_steps<span class="op">;</span>                <span class="co">/* Number of timesteps        */</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> step<span class="op">;</span>                   <span class="co">/* Current step               */</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span>                   <span class="co">/* Current particle           */</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> output_freq<span class="op">;</span>            <span class="co">/* Frequency of output        */</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-6" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> delta_t<span class="op">;</span>             <span class="co">/* Size of timestep           */</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> t<span class="op">;</span>                   <span class="co">/* Current Time               */</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">struct</span> particle_s<span class="op">*</span> curr<span class="op">;</span>    <span class="co">/* Current state of system    */</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> forces<span class="op">;</span>             <span class="co">/* Forces on each particle    */</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">char</span> g_i<span class="op">;</span>                   <span class="co">/*_G_en or _i_nput init conds */</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef COMPUTE_ENERGY</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> kinetic_energy<span class="op">,</span> potential_energy<span class="op">;</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-7" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> start<span class="op">,</span> finish<span class="op">;</span>       <span class="co">/* For timings                */</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>   Get_args<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>n_steps<span class="op">,</span> <span class="op">&amp;</span>delta_t<span class="op">,</span> <span class="op">&amp;</span>output_freq<span class="op">,</span> <span class="op">&amp;</span>g_i<span class="op">);</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>   curr <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> particle_s<span class="op">));</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>   forces <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>g_i <span class="op">==</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-8" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>      Get_init_cond<span class="op">(</span>curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      Gen_init_cond<span class="op">(</span>curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>   GET_TIME<span class="op">(</span>start<span class="op">);</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef COMPUTE_ENERGY</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>   Compute_energy<span class="op">(</span>curr<span class="op">,</span> n<span class="op">,</span> <span class="op">&amp;</span>kinetic_energy<span class="op">,</span> <span class="op">&amp;</span>potential_energy<span class="op">);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-9" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   PE = %e, KE = %e, Total Energy = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>         potential_energy<span class="op">,</span> kinetic_energy<span class="op">,</span> kinetic_energy<span class="op">+</span>potential_energy<span class="op">);</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifndef NO_OUTPUT</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>   Output_state<span class="op">(</span><span class="dv">0</span><span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>step <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> step <span class="op">&lt;=</span> n_steps<span class="op">;</span> step<span class="op">++)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-10" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>      t <span class="op">=</span> step<span class="op">*</span>delta_t<span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">//    memset(forces, 0, n*sizeof(vect_t));</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>         Compute_force<span class="op">(</span>part<span class="op">,</span> forces<span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         Update_part<span class="op">(</span>part<span class="op">,</span> forces<span class="op">,</span> curr<span class="op">,</span> n<span class="op">,</span> delta_t<span class="op">);</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#     ifdef COMPUTE_ENERGY</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-11" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>      Compute_energy<span class="op">(</span>curr<span class="op">,</span> n<span class="op">,</span> <span class="op">&amp;</span>kinetic_energy<span class="op">,</span> <span class="op">&amp;</span>potential_energy<span class="op">);</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;   PE = %e, KE = %e, Total Energy = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>            potential_energy<span class="op">,</span> kinetic_energy<span class="op">,</span> kinetic_energy<span class="op">+</span>potential_energy<span class="op">);</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#     endif</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#     ifndef NO_OUTPUT</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>step <span class="op">%</span> output_freq <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>         Output_state<span class="op">(</span>t<span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-12" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#     endif</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>   GET_TIME<span class="op">(</span>finish<span class="op">);</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Elapsed time = %e seconds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> finish<span class="op">-</span>start<span class="op">);</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>curr<span class="op">);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-13" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>forces<span class="op">);</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* main */</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function: Usage</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-14" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>  Print instructions <span class="cf">for</span> command<span class="op">-</span>line and exit</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In arg<span class="op">:</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    prog_name<span class="op">:</span>  the name of the program as typed on the command<span class="op">-</span>line</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;usage: %s &lt;number of particles&gt; &lt;number of timesteps&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>         prog_name<span class="op">);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-15" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;size of timestep&gt; &lt;output frequency&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;g|i&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;g&#39;: program should generate init conds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;i&#39;: program should get init conds from stdin</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>   exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Usage */</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-16" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Get_args</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Get command line args</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    argc:            number of command line args</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-17" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    argv<span class="op">:</span>            command line args</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_p<span class="op">:</span>             pointer to n<span class="op">,</span> the number of particles</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_steps_p<span class="op">:</span>       pointer to n_steps<span class="op">,</span> the number of timesteps</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    delta_t_p<span class="op">:</span>       pointer to delta_t<span class="op">,</span> the size of each timestep</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    output_freq_p<span class="op">:</span>   pointer to output_freq<span class="op">,</span> which is the number of</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     timesteps between steps whose output is printed</span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-18" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    g_i_p<span class="op">:</span>           pointer to <span class="dt">char</span> which is <span class="ch">&#39;g&#39;</span> <span class="cf">if</span> the init conds</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     should be generated by the program and <span class="ch">&#39;i&#39;</span> <span class="cf">if</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     they should be read from stdin</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">6</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-19" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>n_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>n_steps_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>delta_t_p <span class="op">=</span> strtod<span class="op">(</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>output_freq_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">4</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>g_i_p <span class="op">=</span> argv<span class="op">[</span><span class="dv">5</span><span class="op">][</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>n_p <span class="op">&lt;=</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>n_steps_p <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>delta_t_p <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-20" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;g&#39;</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;n = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_p<span class="op">);</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;n_steps = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_steps_p<span class="op">);</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;delta_t = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>delta_t_p<span class="op">);</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;output_freq = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>output_freq_p<span class="op">);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-21" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;g_i = %c</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>g_i_p<span class="op">);</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_args */</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Get_init_cond</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-22" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Read in initial conditions<span class="op">:</span>  mass<span class="op">,</span> position and velocity</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            <span class="cf">for</span> each particle</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array of n structs<span class="op">,</span> each <span class="kw">struct</span> stores the mass <span class="op">(</span>scalar<span class="op">),</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position <span class="op">(</span>vector<span class="op">),</span> and velocity <span class="op">(</span>vector<span class="op">)</span> of a particle</span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-23" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;For each particle, enter (in order):</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   its mass, its x-coord, its y-coord, &quot;</span><span class="op">);</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;its x-velocity, its y-velocity</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-24" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">);</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-25" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_init_cond */</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Gen_init_cond</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Generate initial conditions:  mass, position and velocity</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *            for each particle</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-26" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array of n structs<span class="op">,</span> each <span class="kw">struct</span> stores the mass <span class="op">(</span>scalar<span class="op">),</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position <span class="op">(</span>vector<span class="op">),</span> and velocity <span class="op">(</span>vector<span class="op">)</span> of a particle</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>      The initial conditions place all particles at</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            equal intervals on the nonnegative x<span class="op">-</span>axis with</span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-27" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            identical masses<span class="op">,</span> and identical initial speeds</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            parallel to the y<span class="op">-</span>axis<span class="op">.</span>  However<span class="op">,</span> some of the</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            velocities are in the positive y<span class="op">-</span>direction and</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            some are negative<span class="op">.</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-28" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mass <span class="op">=</span> <span class="fl">5.0e24</span><span class="op">;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> gap <span class="op">=</span> <span class="fl">1.0e5</span><span class="op">;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> speed <span class="op">=</span> <span class="fl">3.0e4</span><span class="op">;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>   srandom<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>m <span class="op">=</span> mass<span class="op">;</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-29" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> part<span class="op">*</span>gap<span class="op">;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">//    if (random()/((double) RAND_MAX) &gt;= 0.5)</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>part <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>         curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> speed<span class="op">;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-30" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>         curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> <span class="op">-</span>speed<span class="op">;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Gen_init_cond */</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Output_state</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-31" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Print the current state of the system</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array with n elements<span class="op">,</span> curr<span class="op">[</span>i<span class="op">]</span> stores the state <span class="op">(</span>mass<span class="op">,</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position and velocity<span class="op">)</span> of the ith particle</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-32" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;%.2f</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> time<span class="op">);</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">//    printf(&quot;%.3f &quot;, curr[part].m);</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;%3d %10.3e &quot;</span><span class="op">,</span> part<span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]);</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-33" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Output_state */</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-34" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Function<span class="op">:</span>  Compute_force</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Compute the total force on particle part<span class="op">.</span>  Exploit</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            the symmetry <span class="op">(</span>force on particle i due to particle k<span class="op">)</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            <span class="op">=</span> <span class="op">-(</span>force on particle k due to particle i<span class="op">)</span> to also</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            calculate partial forces on other particles<span class="op">.</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    part<span class="op">:</span>   the particle on which we&#39;re computing the total force</span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-35" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   current state of the system<span class="op">:</span>  curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position and velocity of the ith particle</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out arg<span class="op">:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    forces<span class="op">:</span> force<span class="op">[</span>i<span class="op">]</span> stores the total force on the ith particle</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span> This function uses the force due to gravitation<span class="op">.</span>  So</span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-36" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> the force on particle i due to particle k is given by</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    m_i m_k <span class="op">(</span>s_k <span class="op">-</span> s_i<span class="op">)/|</span>s_k <span class="op">-</span> s_i<span class="op">|^</span><span class="dv">2</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Here<span class="op">,</span> m_j is the mass of particle j and s_k is its position vector</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> <span class="op">(</span>at time t<span class="op">).</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-37" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> k<span class="op">;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mg<span class="op">;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>   vect_t f_part_k<span class="op">;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> len<span class="op">,</span> len_3<span class="op">,</span> fact<span class="op">;</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-38" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb40"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Current total force on particle %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>         part<span class="op">,</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">],</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>   forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">=</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> n<span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>k <span class="op">!=</span> part<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-39" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb41"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* Compute force on part due to k */</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>k<span class="op">].</span>s<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>k<span class="op">].</span>s<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>         len <span class="op">=</span> sqrt<span class="op">(</span>f_part_k<span class="op">[</span>X<span class="op">]*</span>f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> f_part_k<span class="op">[</span>Y<span class="op">]*</span>f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>         len_3 <span class="op">=</span> len<span class="op">*</span>len<span class="op">*</span>len<span class="op">;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>         mg <span class="op">=</span> <span class="op">-</span>G<span class="op">*</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">*</span>curr<span class="op">[</span>k<span class="op">].</span>m<span class="op">;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>         fact <span class="op">=</span> mg<span class="op">/</span>len_3<span class="op">;</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-40" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb42"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>   <span class="pp">#     ifdef DEBUG</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;Force on particle %d due to particle %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>               part<span class="op">,</span> k<span class="op">,</span> f_part_k<span class="op">[</span>X<span class="op">],</span> f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>   <span class="pp">#     endif</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-41" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>         <span class="co">/* Add force in to total forces */</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>         forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>         forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_force */</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-42" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb44"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Update_part</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Update the velocity and position for particle part</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    part:    the particle we&#39;re updating</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    forces:  forces[i] stores the total force on the ith particle</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-43" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       number of particles</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In<span class="op">/</span>out arg<span class="op">:</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>    curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span> position and velocity of the</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>             ith particle</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>  This version uses Euler&#39;s method to update both the velocity</span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-44" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb46"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    and the position<span class="op">.</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> fact <span class="op">=</span> delta_t<span class="op">/</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-45" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb47"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Before update of %d:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> part<span class="op">);</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Position  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Velocity  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Net force = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">],</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">];</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-46" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb48"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">];</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Position of %d = (%.3e, %.3e), Velocity = (%.3e,%.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>         part<span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">],</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>               curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-47" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb49"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">// curr[part].s[X] += delta_t * curr[part].v[X];</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">// curr[part].s[Y] += delta_t * curr[part].v[Y];</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Update_part */</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Compute_energy</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-48" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Compute the kinetic and potential energy in the system</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   current state of the system<span class="op">,</span> curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position and velocity of the ith particle</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    kin_en_p<span class="op">:</span> pointer to kinetic energy of system</span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-49" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb51"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pot_en_p<span class="op">:</span> pointer to potential energy of system</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_energy<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span><span class="op">*</span> kin_en_p<span class="op">,</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> pot_en_p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> i<span class="op">,</span> j<span class="op">;</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>   vect_t diff<span class="op">;</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> pe <span class="op">=</span> <span class="fl">0.0</span><span class="op">,</span> ke <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-50" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb52"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> dist<span class="op">,</span> speed_sqr<span class="op">;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>      speed_sqr <span class="op">=</span> curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>X<span class="op">]*</span>curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]*</span>curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>      ke <span class="op">+=</span> curr<span class="op">[</span>i<span class="op">].</span>m<span class="op">*</span>speed_sqr<span class="op">;</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>   ke <span class="op">*=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-51" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb53"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">-</span><span class="dv">1</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>j <span class="op">=</span> i<span class="op">+</span><span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> n<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>         diff<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>i<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>j<span class="op">].</span>s<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>         diff<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>i<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>j<span class="op">].</span>s<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>         dist <span class="op">=</span> sqrt<span class="op">(</span>diff<span class="op">[</span>X<span class="op">]*</span>diff<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> diff<span class="op">[</span>Y<span class="op">]*</span>diff<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>         pe <span class="op">+=</span> <span class="op">-</span>G<span class="op">*</span>curr<span class="op">[</span>i<span class="op">].</span>m<span class="op">*</span>curr<span class="op">[</span>j<span class="op">].</span>m<span class="op">/</span>dist<span class="op">;</span></span></code></pre></div>
</section>
<section id="osnovna-forma-algoritma-52" class="slide level2">
<h2>Osnovna forma algoritma</h2>
<div class="sourceCode" id="cb54"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>kin_en_p <span class="op">=</span> ke<span class="op">;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>pot_en_p <span class="op">=</span> pe<span class="op">;</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_energy */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb55"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;timer.h&quot;</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DIM 2  </span><span class="co">/* Two-dimensional system */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-1" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb56"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define X 0    </span><span class="co">/* x-coordinate subscript */</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define Y 1    </span><span class="co">/* y-coordinate subscript */</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">double</span> G <span class="op">=</span> <span class="fl">6.673e-11</span><span class="op">;</span>  <span class="co">/* Gravitational constant. */</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                             <span class="co">/* Units are m^3/(kg*s^2)  */</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">// const double G = 0.1;  /* Gravitational constant. */</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                          <span class="co">/* Units are m^3/(kg*s^2)  */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-2" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb57"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">double</span> vect_t<span class="op">[</span>DIM<span class="op">];</span>  <span class="co">/* Vector type for position, etc. */</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> particle_s <span class="op">{</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> m<span class="op">;</span>  <span class="co">/* Mass     */</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>   vect_t s<span class="op">;</span>  <span class="co">/* Position */</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>   vect_t v<span class="op">;</span>  <span class="co">/* Velocity */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-3" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">);</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">);</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-4" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb59"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">);</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_energy<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span><span class="op">*</span> kin_en_p<span class="op">,</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> pot_en_p<span class="op">);</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-5" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*--------------------------------------------------------------------*/</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n<span class="op">;</span>                      <span class="co">/* Number of particles        */</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n_steps<span class="op">;</span>                <span class="co">/* Number of timesteps        */</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> step<span class="op">;</span>                   <span class="co">/* Current step               */</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span>                   <span class="co">/* Current particle           */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-6" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb61"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> output_freq<span class="op">;</span>            <span class="co">/* Frequency of output        */</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> delta_t<span class="op">;</span>             <span class="co">/* Size of timestep           */</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> t<span class="op">;</span>                   <span class="co">/* Current Time               */</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">struct</span> particle_s<span class="op">*</span> curr<span class="op">;</span>    <span class="co">/* Current state of system    */</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> forces<span class="op">;</span>             <span class="co">/* Forces on each particle    */</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">char</span> g_i<span class="op">;</span>                   <span class="co">/*_G_en or _i_nput init conds */</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef COMPUTE_ENERGY</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-7" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb62"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> kinetic_energy<span class="op">,</span> potential_energy<span class="op">;</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> start<span class="op">,</span> finish<span class="op">;</span>       <span class="co">/* For timings                */</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>   Get_args<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>n_steps<span class="op">,</span> <span class="op">&amp;</span>delta_t<span class="op">,</span> <span class="op">&amp;</span>output_freq<span class="op">,</span> <span class="op">&amp;</span>g_i<span class="op">);</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>   curr <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> particle_s<span class="op">));</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>   forces <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-8" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb63"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>g_i <span class="op">==</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>      Get_init_cond<span class="op">(</span>curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>      Gen_init_cond<span class="op">(</span>curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>   GET_TIME<span class="op">(</span>start<span class="op">);</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef COMPUTE_ENERGY</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-9" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb64"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>   Compute_energy<span class="op">(</span>curr<span class="op">,</span> n<span class="op">,</span> <span class="op">&amp;</span>kinetic_energy<span class="op">,</span> <span class="op">&amp;</span>potential_energy<span class="op">);</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   PE = %e, KE = %e, Total Energy = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>         potential_energy<span class="op">,</span> kinetic_energy<span class="op">,</span> kinetic_energy<span class="op">+</span>potential_energy<span class="op">);</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifndef NO_OUTPUT</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>   Output_state<span class="op">(</span><span class="dv">0</span><span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-10" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb65"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>step <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> step <span class="op">&lt;=</span> n_steps<span class="op">;</span> step<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>      t <span class="op">=</span> step<span class="op">*</span>delta_t<span class="op">;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* Particle n-1 will have all forces computed after call to</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">       * Compute_force(n-2, . . .) */</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>      memset<span class="op">(</span>forces<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">-</span><span class="dv">1</span><span class="op">;</span> part<span class="op">++)</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>         Compute_force<span class="op">(</span>part<span class="op">,</span> forces<span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-11" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb66"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>         Update_part<span class="op">(</span>part<span class="op">,</span> forces<span class="op">,</span> curr<span class="op">,</span> n<span class="op">,</span> delta_t<span class="op">);</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#     ifdef COMPUTE_ENERGY</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>      Compute_energy<span class="op">(</span>curr<span class="op">,</span> n<span class="op">,</span> <span class="op">&amp;</span>kinetic_energy<span class="op">,</span> <span class="op">&amp;</span>potential_energy<span class="op">);</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;   PE = %e, KE = %e, Total Energy = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>            potential_energy<span class="op">,</span> kinetic_energy<span class="op">,</span> kinetic_energy<span class="op">+</span>potential_energy<span class="op">);</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#     endif</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-12" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb67"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#     ifndef NO_OUTPUT</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>step <span class="op">%</span> output_freq <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>         Output_state<span class="op">(</span>t<span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#     endif</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>   GET_TIME<span class="op">(</span>finish<span class="op">);</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-13" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb68"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Elapsed time = %e seconds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> finish<span class="op">-</span>start<span class="op">);</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>curr<span class="op">);</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>forces<span class="op">);</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* main */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-14" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb69"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function: Usage</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:  Print instructions for command-line and exit</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * In arg:</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    prog_name:  the name of the program as typed on the command-line</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-15" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb70"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;usage: %s &lt;number of particles&gt; &lt;number of timesteps&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>         prog_name<span class="op">);</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;size of timestep&gt; &lt;output frequency&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;g|i&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;g&#39;: program should generate init conds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;i&#39;: program should get init conds from stdin</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-16" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb71"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>   exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Usage */</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Get_args</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-17" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb72"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Get command line args</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    argc<span class="op">:</span>            number of command line args</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    argv<span class="op">:</span>            command line args</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_p<span class="op">:</span>             pointer to n<span class="op">,</span> the number of particles</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_steps_p<span class="op">:</span>       pointer to n_steps<span class="op">,</span> the number of timesteps</span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-18" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb73"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    delta_t_p<span class="op">:</span>       pointer to delta_t<span class="op">,</span> the size of each timestep</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    output_freq_p<span class="op">:</span>   pointer to output_freq<span class="op">,</span> which is the number of</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     timesteps between steps whose output is printed</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    g_i_p<span class="op">:</span>           pointer to <span class="dt">char</span> which is <span class="ch">&#39;g&#39;</span> <span class="cf">if</span> the init conds</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     should be generated by the program and <span class="ch">&#39;i&#39;</span> <span class="cf">if</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     they should be read from stdin</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-19" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb74"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">6</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>n_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>n_steps_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>delta_t_p <span class="op">=</span> strtod<span class="op">(</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>output_freq_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">4</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-20" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb75"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>g_i_p <span class="op">=</span> argv<span class="op">[</span><span class="dv">5</span><span class="op">][</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>n_p <span class="op">&lt;=</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>n_steps_p <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>delta_t_p <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;g&#39;</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;n = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_p<span class="op">);</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-21" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb76"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;n_steps = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_steps_p<span class="op">);</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;delta_t = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>delta_t_p<span class="op">);</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;output_freq = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>output_freq_p<span class="op">);</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;g_i = %c</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>g_i_p<span class="op">);</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_args */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-22" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb77"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Get_init_cond</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Read in initial conditions:  mass, position and velocity</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"> *            for each particle</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    n:      number of particles</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-23" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb78"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array of n structs<span class="op">,</span> each <span class="kw">struct</span> stores the mass <span class="op">(</span>scalar<span class="op">),</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position <span class="op">(</span>vector<span class="op">),</span> and velocity <span class="op">(</span>vector<span class="op">)</span> of a particle</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-24" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb79"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;For each particle, enter (in order):</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   its mass, its x-coord, its y-coord, &quot;</span><span class="op">);</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;its x-velocity, its y-velocity</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">);</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-25" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb80"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_init_cond */</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Gen_init_cond</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-26" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb81"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Generate initial conditions<span class="op">:</span>  mass<span class="op">,</span> position and velocity</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            <span class="cf">for</span> each particle</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array of n structs<span class="op">,</span> each <span class="kw">struct</span> stores the mass <span class="op">(</span>scalar<span class="op">),</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position <span class="op">(</span>vector<span class="op">),</span> and velocity <span class="op">(</span>vector<span class="op">)</span> of a particle</span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-27" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb82"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>      The initial conditions place all particles at</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            equal intervals on the nonnegative x<span class="op">-</span>axis with</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            identical masses<span class="op">,</span> and identical initial speeds</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            parallel to the y<span class="op">-</span>axis<span class="op">.</span>  However<span class="op">,</span> some of the</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            velocities are in the positive y<span class="op">-</span>direction and</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            some are negative<span class="op">.</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-28" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb83"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mass <span class="op">=</span> <span class="fl">5.0e24</span><span class="op">;</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> gap <span class="op">=</span> <span class="fl">1.0e5</span><span class="op">;</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> speed <span class="op">=</span> <span class="fl">3.0e4</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-29" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb84"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>   srandom<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>m <span class="op">=</span> mass<span class="op">;</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> part<span class="op">*</span>gap<span class="op">;</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co">//    if (random()/((double) RAND_MAX) &gt;= 0.5)</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-30" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb85"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>part <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>         curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> speed<span class="op">;</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>         curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> <span class="op">-</span>speed<span class="op">;</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Gen_init_cond */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-31" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb86"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Output_state</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Print the current state of the system</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    curr:   array with n elements, curr[i] stores the state (mass,</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *            position and velocity) of the ith particle</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-32" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb87"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;%.2f</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> time<span class="op">);</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co">//    printf(&quot;%.3f &quot;, curr[part].m);</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-33" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb88"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;%3d %10.3e &quot;</span><span class="op">,</span> part<span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Output_state */</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-34" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb89"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Compute_force</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Compute the total force on particle part.  Exploit</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *            the symmetry (force on particle i due to particle k)</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *            = -(force on particle k due to particle i) to also</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-35" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb90"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            calculate partial forces on other particles<span class="op">.</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    part<span class="op">:</span>   the particle on which we&#39;re computing the total force</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   current state of the system<span class="op">:</span>  curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position and velocity of the ith particle</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out arg<span class="op">:</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-36" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb91"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    forces<span class="op">:</span> force<span class="op">[</span>i<span class="op">]</span> stores the total force on the ith particle</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span> This function uses the force due to gravitation<span class="op">.</span>  So</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> the force on particle i due to particle k is given by</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    m_i m_k <span class="op">(</span>s_k <span class="op">-</span> s_i<span class="op">)/|</span>s_k <span class="op">-</span> s_i<span class="op">|^</span><span class="dv">2</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-37" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb92"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Here<span class="op">,</span> m_j is the mass of particle j and s_k is its position vector</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> <span class="op">(</span>at time t<span class="op">).</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> k<span class="op">;</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mg<span class="op">;</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-38" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb93"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>   vect_t f_part_k<span class="op">;</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> len<span class="op">,</span> len_3<span class="op">,</span> fact<span class="op">;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Current total force on particle %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>         part<span class="op">,</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">],</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-39" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb94"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>k <span class="op">=</span> part<span class="op">+</span><span class="dv">1</span><span class="op">;</span> k <span class="op">&lt;</span> n<span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* Compute force on part due to k */</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>      f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>k<span class="op">].</span>s<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>      f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>k<span class="op">].</span>s<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>      len <span class="op">=</span> sqrt<span class="op">(</span>f_part_k<span class="op">[</span>X<span class="op">]*</span>f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> f_part_k<span class="op">[</span>Y<span class="op">]*</span>f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>      len_3 <span class="op">=</span> len<span class="op">*</span>len<span class="op">*</span>len<span class="op">;</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>      mg <span class="op">=</span> <span class="op">-</span>G<span class="op">*</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">*</span>curr<span class="op">[</span>k<span class="op">].</span>m<span class="op">;</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-40" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb95"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>      fact <span class="op">=</span> mg<span class="op">/</span>len_3<span class="op">;</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>      f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>      f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#     ifdef DEBUG</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;Force on particle %d due to particle %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>            part<span class="op">,</span> k<span class="op">,</span> f_part_k<span class="op">[</span>X<span class="op">],</span> f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#     endif</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-41" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb96"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* Add force in to total forces */</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>      forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>      forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>      forces<span class="op">[</span>k<span class="op">][</span>X<span class="op">]</span> <span class="op">-=</span> f_part_k<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>      forces<span class="op">[</span>k<span class="op">][</span>Y<span class="op">]</span> <span class="op">-=</span> f_part_k<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-42" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb97"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_force */</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Update_part</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Update the velocity and position for particle part</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-43" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb98"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    part<span class="op">:</span>    the particle we&#39;re updating</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    forces<span class="op">:</span>  forces<span class="op">[</span>i<span class="op">]</span> stores the total force on the ith particle</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       number of particles</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In<span class="op">/</span>out arg<span class="op">:</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>    curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span> position and velocity of the</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>             ith particle</span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-44" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb99"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>  This version uses Euler&#39;s method to update both the velocity</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    and the position<span class="op">.</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> fact <span class="op">=</span> delta_t<span class="op">/</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">;</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-45" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb100"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Before update of %d:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> part<span class="op">);</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Position  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Velocity  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Net force = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">],</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-46" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb101"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">];</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Position of %d = (%.3e, %.3e), Velocity = (%.3e,%.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>         part<span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">],</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-47" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb102"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>               curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">// curr[part].s[X] += delta_t * curr[part].v[X];</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co">// curr[part].s[Y] += delta_t * curr[part].v[Y];</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Update_part */</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-48" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb103"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Compute_energy</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Compute the kinetic and potential energy in the system</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co"> *    curr:   current state of the system, curr[i] stores the mass,</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *            position and velocity of the ith particle</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    n:      number of particles</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-49" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb104"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    kin_en_p<span class="op">:</span> pointer to kinetic energy of system</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pot_en_p<span class="op">:</span> pointer to potential energy of system</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_energy<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span><span class="op">*</span> kin_en_p<span class="op">,</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> pot_en_p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> i<span class="op">,</span> j<span class="op">;</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-50" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb105"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>   vect_t diff<span class="op">;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> pe <span class="op">=</span> <span class="fl">0.0</span><span class="op">,</span> ke <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> dist<span class="op">,</span> speed_sqr<span class="op">;</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>      speed_sqr <span class="op">=</span> curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>X<span class="op">]*</span>curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]*</span>curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>      ke <span class="op">+=</span> curr<span class="op">[</span>i<span class="op">].</span>m<span class="op">*</span>speed_sqr<span class="op">;</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-51" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb106"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>   ke <span class="op">*=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">-</span><span class="dv">1</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>j <span class="op">=</span> i<span class="op">+</span><span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> n<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>         diff<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>i<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>j<span class="op">].</span>s<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>         diff<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>i<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>j<span class="op">].</span>s<span class="op">[</span>Y<span class="op">];</span></span></code></pre></div>
</section>
<section id="redukovana-forma-algoritma-52" class="slide level2">
<h2>Redukovana forma algoritma</h2>
<div class="sourceCode" id="cb107"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>         dist <span class="op">=</span> sqrt<span class="op">(</span>diff<span class="op">[</span>X<span class="op">]*</span>diff<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> diff<span class="op">[</span>Y<span class="op">]*</span>diff<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>         pe <span class="op">+=</span> <span class="op">-</span>G<span class="op">*</span>curr<span class="op">[</span>i<span class="op">].</span>m<span class="op">*</span>curr<span class="op">[</span>j<span class="op">].</span>m<span class="op">/</span>dist<span class="op">;</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>kin_en_p <span class="op">=</span> ke<span class="op">;</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>pot_en_p <span class="op">=</span> pe<span class="op">;</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section></section>
<section>
<section id="diskusija-paralelizacije-u-modelu-deljene-memorije" class="title-slide slide level1">
<h1>Diskusija paralelizacije u modelu deljene memorije</h1>
<p>Problem n tela</p>
</section>
<section id="problemi-paralelizacije-koda-koristeći-model-deljene-memorije" class="slide level2">
<h2>Problemi paralelizacije koda koristeći model deljene memorije</h2>
<ul>
<li>Suočeni smo sa klasičnim problemom: imamo kod koji radi serijski i hoćemo da ga ubrzamo.</li>
<li>Ovo je najčešće situacija u kojoj se HPC inženjer nađe, domenski ekspert vam da nekakav kod i pozove vas da ga učinite bržim.</li>
<li>Mnogo bržim.</li>
<li>Jedino što se razlikuje od stvarnosti jeste što je šansa da će kod biti urađen u nečemo pogodnijem za brzo prototipiziranje, kao što je Matlab ili, vrlo četo ovih dana, Python sa proširenjima za naučno računarstvo.</li>
<li>U svakom slučaju, kako prići ovakvom problemu?</li>
</ul>
</section>
<section id="fosterova-metodolgija" class="slide level2">
<h2>Fosterova metodolgija</h2>
<ul>
<li>Particija (eng. Partition)</li>
<li>Komunikacija (eng. Communication)</li>
<li>Kombinacija (eng. Agglomeration)</li>
<li>Mapiranje (eng. Mapping)</li>
</ul>
</section>
<section id="particija" class="slide level2">
<h2>Particija</h2>
<ul>
<li>Particija je podela osnovnog zadatka na pod-zadatke na najprimitivnijem nivou.</li>
<li>Ovde nas ne zanima nikakvo ograničenje: samo lista stvari koje moramo da uradimo, a koje se na nivou apstrakcije na kome programiramo ne mogu dalje dekomponovati.</li>
<li>Ako počinjemo od serijskog algoritma, ovaj posao se sastoji od brojanja.</li>
</ul>
</section>
<section id="particija-1" class="slide level2">
<h2>Particija</h2>
<p><img data-src="img/2022-12-12-14-46-51.png" /></p>
</section>
<section id="komunikacija" class="slide level2">
<h2>Komunikacija</h2>
<ul>
<li>Kada imamo primitivne zadatke, sledeći korak jeste da se ustanovi kakva je komunikacija između njih.</li>
<li>U modelu deljene memorije to se naročito svodi na graf zavisnosti: koji podatak je potreban za računanje kog podataka.</li>
<li>Ako se setimo onog fibonačijevog niza od ranije, tu je baš zavisnost između podataka bila deo posla koji nas je ograničavao.</li>
</ul>
</section>
<section id="komunikacija-1" class="slide level2">
<h2>Komunikacija</h2>
<p><img data-src="img/2022-12-12-14-47-07.png" /></p>
</section>
<section id="kombinacija" class="slide level2">
<h2>Kombinacija</h2>
<ul>
<li>Ako su nam primitivni zadaci potpuno nezavisni, onda možemo da ih kombinujemo kako god želimo.</li>
<li>U praksi, biće ograničenja, i ta ograničenja vode naše kombinovanje primitivnih zadataka u celine pogodne za obradu.</li>
</ul>
</section>
<section id="kombinacija-1" class="slide level2">
<h2>Kombinacija</h2>
<p><img data-src="img/2022-12-12-14-47-22.png" /></p>
</section>
<section id="mapiranje" class="slide level2">
<h2>Mapiranje</h2>
<ul>
<li>Konačan korak jeste da kombinovane celine podelimo u grupe koje će se izvršavati na procesnim elementima.</li>
<li>Mapiranje je takođe podložno ograničenjima, specifično, ograničenjima hardvera/arhitekture.</li>
</ul>
</section>
<section id="mapiranje-1" class="slide level2">
<h2>Mapiranje</h2>
<p><img data-src="img/2022-12-12-14-47-38.png" /></p>
</section>
<section id="primena-fosterove-metodologije-na-problem-n-tela" class="slide level2">
<h2>Primena Fosterove metodologije na problem n tela</h2>
<ul>
<li>Particija
<ul>
<li>Za svaku česticu (opšti broj i) i korak vremena (opšti broj k) sračunati
<ul>
<li><span class="math inline">\(\vec{F_i}(t_k-1)\)</span></li>
<li><span class="math inline">\(\vec{v_i}(t_k)\)</span></li>
<li><span class="math inline">\(\vec{r_i}(t_k)\)</span></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="primena-fosterove-metodologije-na-problem-n-tela-1" class="slide level2">
<h2>Primena Fosterove metodologije na problem n tela</h2>
<ul>
<li>Komunikacija
<ul>
<li>Za <span class="math inline">\(\vec{v_i}(t_k)\)</span> treba
<ul>
<li><span class="math inline">\(\vec{v_i}(t_{k-1})\)</span></li>
<li><span class="math inline">\(\vec{F_i}(t_{k-1})\)</span></li>
<li><span class="math inline">\(\vec{r_i}(t_{k-1})\)</span></li>
<li><span class="math inline">\(\vec{r_j}(t_{k-1})\)</span></li>
</ul></li>
<li>Za <span class="math inline">\(\vec{r_i}(t_k)\)</span> treba
<ul>
<li><span class="math inline">\(\vec{r_i}(t_{k-1})\)</span></li>
<li><span class="math inline">\(\vec{v_i}(t_{k-1})\)</span></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="primena-fosterove-metodologije-na-problem-n-tela-2" class="slide level2">
<h2>Primena Fosterove metodologije na problem n tela</h2>
<ul>
<li>Kombinacija
<ul>
<li>Većina komunikacije ide po principu čestica na česticu (i to najviše ista čestica)</li>
<li>To znači da su nam kompozitni zadaci prirodno zadaci proračuna za individualnu česticu.</li>
</ul></li>
<li>Mapiranje
<ul>
<li>Imamo dve dimenzija mapiranja: broj čestica i broj koraka.</li>
<li>Ojlerova metoda (kao što smo videli u analizi komunikacije) je fundamentalno sekvencijalna.</li>
<li>Ovo nameće da paralelizam ima samo smisla ako raspoređujemo čestice po procesima.</li>
</ul></li>
</ul>
</section>
<section id="praktično-mapiranje" class="slide level2">
<h2>Praktično mapiranje</h2>
<ul>
<li>To znači da, u slučaju modela deljene memorije, na svaku sistemsku nit želimo da blokovski rasporedimo <span class="math inline">\(\frac{n}{p}\)</span> čestica gde je <span class="math inline">\(p\)</span> broj sistemskih niti.</li>
<li>Zašto blokovski raspored? Zato što smanjuje keš omašaje a posao je homogen i može se lako razdeliti na ovaj način.</li>
<li>Ovo važi samo ako ne koristimo redukciju da simetrijom smanjimo broj koraka.</li>
</ul>
</section>
<section id="mapiranje-u-slučaju-redukovanog-algoritma" class="slide level2">
<h2>Mapiranje u slučaju redukovanog algoritma</h2>
<ul>
<li>Teškoća je ovde u tome što nisu sada iteracije za svaku vrednost ’i’ iste. Niske vrednosti i su mnogo ’skuplje’ nego velike vrednosti i.</li>
<li>Ovo znači da će u blokovskoj podeli da oni koji dobiju visoki blok završiti ranije i morati da besposleno čekaju niže blokove.</li>
<li>Ovaj scenario je, dakle, dobar za cikličnu distribuciju.</li>
<li>Ali ciklična distribucija pati od visokog broja omašaja u kešu.</li>
<li>Pa šta baca više vremena? Nije moguće reći <em>a priori.</em> Ovo je jedna od (mnogo) situacija u HPC svetu gde je profilisanje koda neophodno.</li>
<li>Univerzalno rešenje HPC-a: idi i pogledaj.</li>
</ul>
</section>
<section id="paralelizacija-neredukovanog-algoritma" class="slide level2">
<h2>Paralelizacija neredukovanog algoritma</h2>
<ul>
<li>Naivni pristup jeste da se uzmu dve unutarnje petlje algoritma (ona koja računa sile i ona koja računa pomeraje i brzine) i da se for-ovi paralelizuju u statički raspored sa <span class="math inline">\(\frac{n}{p}\)</span> po niti.</li>
<li>Kako to izgleda?</li>
</ul>
</section>
<section id="paralelizacija-neredukovanog-algoritma-1" class="slide level2">
<h2>Paralelizacija neredukovanog algoritma</h2>
<p><img data-src="img/2022-12-12-14-56-47.png" /></p>
</section>
<section id="potencijalni-problemi" class="slide level2">
<h2>Potencijalni problemi?</h2>
<ul>
<li>Potencijalan problem jeste situacija gde paralelne niti mogu da pristupaju istoj promenljivoj na način koji otvara šansu za konflikt, tkzv. ‘race condition.’</li>
<li>Zato, između ostalog, je komunikacija toliko bitna.</li>
<li>Kako izgleda pseudo-kod prve petlje?</li>
</ul>
</section>
<section id="analiza-prve-petlje" class="slide level2">
<h2>Analiza prve petlje</h2>
<p><img data-src="img/2022-12-12-14-57-25.png" /></p>
</section>
<section id="analiza-prve-petlje-1" class="slide level2">
<h2>Analiza prve petlje</h2>
<ul>
<li>Za svaki <code>F[i]</code> može mu pristupiti samo jedna nit zbog prirode for konstrukta.</li>
<li>Nit <code>i</code> će pristupiti promenljivama <code>m[j]</code> i <code>r[j]</code> ali ove promenljive se samo čitaju ovde, tako da smo bezbedni. Samo pisanje stvara problem.</li>
<li>Sve ostale promenljive su privremene i stoga, mogu biti privatne, te su bezbedne.</li>
</ul>
</section>
<section id="analiza-druge-petlje" class="slide level2">
<h2>Analiza druge petlje</h2>
<p><img data-src="img/2022-12-12-14-58-12.png" /></p>
</section>
<section id="analiza-druge-petlje-1" class="slide level2">
<h2>Analiza druge petlje</h2>
<ul>
<li>Isključivo se piše u promenljive <code>r[i]</code> i <code>v[i]</code> koje su ekskluzivne za odgovarajuću nit.</li>
<li>Sve ostalo se samo čita.</li>
<li>Nema mogućeg konflikta.</li>
</ul>
</section>
<section id="redukovani-algoritam-1" class="slide level2">
<h2>Redukovani algoritam</h2>
<p><img data-src="img/2022-12-12-14-58-46.png" /></p>
</section>
<section id="problemi" class="slide level2">
<h2>Problemi</h2>
<ul>
<li>Prva petlja nije problem. Može biti paralelizovana manje-više koliko god želimo.</li>
<li>Druga petlja je problem</li>
<li>Nit <code>i</code> piše i u vrednost <code>F[i]</code> i u vrednost <code>F[j]</code> što znači da je destruktivno preklapanje između niti apsolutno moguće.</li>
<li>Ako zamislimo trivijalan primer 4 čestice i 2 niti uz blok-particiju onda računamo silu na treću česticu kao: $ = - - <span class="math inline">\(\vec{f_{1,3}} - \vec{f_{2,3}}\)</span></li>
<li>Ako, dalje, zamislimo da nit 0 računa prva dva elementa, a nit 1 treći, imamo konflikt. Rezultat zavisi od tajminga.</li>
</ul>
</section>
<section id="naivno-rešenje" class="slide level2">
<h2>Naivno rešenje</h2>
<p><img data-src="img/2022-12-12-15-01-26.png" /></p>
</section>
<section id="naivno-rešenje-1" class="slide level2">
<h2>Naivno rešenje</h2>
<ul>
<li>Ovo radi, nema problema, ali pretvara naš paralelni kod u serijski u kom slučaju, što smo se trudili?</li>
</ul>
</section>
<section id="malo-manje-naivno-rešenje" class="slide level2">
<h2>Malo manje naivno rešenje</h2>
<p><img data-src="img/2022-12-12-15-01-52.png" /></p>
</section>
<section id="malo-manje-naivno-rešenje-1" class="slide level2">
<h2>Malo manje naivno rešenje</h2>
<ul>
<li>Ovo je mnogo bolje.</li>
<li>Nemamo više jedan kritični region koji blokira sve, nego samo tretiramo svaku česticu kao kritični resurs.</li>
<li>Bolje.</li>
<li>Ali može još bolje.</li>
</ul>
</section>
<section id="lokalno-čuvanje" class="slide level2">
<h2>Lokalno čuvanje</h2>
<ul>
<li>Umesto da odmah računamo sve sile i sabiramo ih i smeštamo gde treba mi podelimo posao na dva:
<ul>
<li>Računanje svih sila jedne niti koje smestimo u za nit lokalnu promenljivu.</li>
<li>Zbrajanje svih sila jedne čestica tako što se zbrajaju vrednosti lokalnih promenljivih.</li>
</ul></li>
<li>Onda možemo da paralelizujemo ove dve faze odvojeno sa tačkom sinhronizacije između.</li>
</ul>
</section>
<section id="faza-1" class="slide level2">
<h2>Faza 1</h2>
<ul>
<li>Ovo je isti kod kao i ranije, ali sada svaka nit ima svoje podatke o silama.</li>
<li>To znači da imamo na kraju malo traćenje memorije i gomilu polu-rezultata.</li>
<li>Nema konflikta zato što jedino u šta se piše je lokalno za nit.</li>
</ul>
</section>
<section id="faza-1-1" class="slide level2">
<h2>Faza 1</h2>
<p><img data-src="img/2022-12-12-15-03-27.png" /></p>
</section>
<section id="faza-2" class="slide level2">
<h2>Faza 2</h2>
<ul>
<li>Pretvaramo parcijalne u konačne rezultate.</li>
<li>Možemo o ovome da mislimo kao o ručnoj implementaciji operacije redukcije.</li>
<li>Nema šanse za konflikt jer i-ta nit je “vlasnik” i-te čestice, a samo se u to piše.</li>
</ul>
</section>
<section id="faza-2-1" class="slide level2">
<h2>Faza 2</h2>
<p><img data-src="img/2022-12-12-15-03-39.png" /></p>
</section></section>
<section>
<section id="implementacija-paralelizacije-u-modelu-deljene-memorije" class="title-slide slide level1">
<h1>Implementacija paralelizacije u modelu deljene memorije</h1>
<p>Problem n tela</p>
</section>
<section id="omp-osnovna-forma" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb108"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;omp.h&gt;</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DIM 2  </span><span class="co">/* Two-dimensional system */</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define X 0    </span><span class="co">/* x-coordinate subscript */</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define Y 1    </span><span class="co">/* y-coordinate subscript */</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-1" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb109"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">double</span> G <span class="op">=</span> <span class="fl">6.673e-11</span><span class="op">;</span>  <span class="co">/* Gravitational constant. */</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                             <span class="co">/* Units are m^3/(kg*s^2)  */</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="co">// const double G = 0.1;  /* Gravitational constant. */</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>                       <span class="co">/* Units are m^3/(kg*s^2)  */</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">double</span> vect_t<span class="op">[</span>DIM<span class="op">];</span>  <span class="co">/* Vector type for position, etc. */</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-2" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb110"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> particle_s <span class="op">{</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> m<span class="op">;</span>  <span class="co">/* Mass     */</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>   vect_t s<span class="op">;</span>  <span class="co">/* Position */</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>   vect_t v<span class="op">;</span>  <span class="co">/* Velocity */</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-3" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb111"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">);</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> thread_count_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span> <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">);</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-4" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb112"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">);</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*--------------------------------------------------------------------*/</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n<span class="op">;</span>                      <span class="co">/* Number of particles        */</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-5" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb113"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n_steps<span class="op">;</span>                <span class="co">/* Number of timesteps        */</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> step<span class="op">;</span>                   <span class="co">/* Current step               */</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span>                   <span class="co">/* Current particle           */</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> output_freq<span class="op">;</span>            <span class="co">/* Frequency of output        */</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> delta_t<span class="op">;</span>             <span class="co">/* Size of timestep           */</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> t<span class="op">;</span>                   <span class="co">/* Current Time               */</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">struct</span> particle_s<span class="op">*</span> curr<span class="op">;</span>    <span class="co">/* Current state of system    */</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-6" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb114"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> forces<span class="op">;</span>             <span class="co">/* Forces on each particle    */</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> thread_count<span class="op">;</span>           <span class="co">/* Number of threads          */</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">char</span> g_i<span class="op">;</span>                   <span class="co">/*_G_en or _i_nput init conds */</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> start<span class="op">,</span> finish<span class="op">;</span>       <span class="co">/* For timings                */</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>   Get_args<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">,</span> <span class="op">&amp;</span>thread_count<span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>n_steps<span class="op">,</span> <span class="op">&amp;</span>delta_t<span class="op">,</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>         <span class="op">&amp;</span>output_freq<span class="op">,</span> <span class="op">&amp;</span>g_i<span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-7" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb115"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>   curr <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> particle_s<span class="op">));</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>   forces <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>g_i <span class="op">==</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>      Get_init_cond<span class="op">(</span>curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>      Gen_init_cond<span class="op">(</span>curr<span class="op">,</span> n<span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-8" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb116"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>   start <span class="op">=</span> omp_get_wtime<span class="op">();</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifndef NO_OUTPUT</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>   Output_state<span class="op">(</span><span class="dv">0</span><span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  pragma omp parallel num_threads(thread_count) default(none) \</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="pp">      shared(curr, forces, thread_count, delta_t, n, n_steps, output_freq) \</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="pp">      private(step, part, t)</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-9" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb117"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>step <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> step <span class="op">&lt;=</span> n_steps<span class="op">;</span> step<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>      t <span class="op">=</span> step<span class="op">*</span>delta_t<span class="op">;</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co">//    memset(forces, 0, n*sizeof(vect_t));</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#     pragma omp for</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>         Compute_force<span class="op">(</span>part<span class="op">,</span> forces<span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#     pragma omp for</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-10" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb118"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>         Update_part<span class="op">(</span>part<span class="op">,</span> forces<span class="op">,</span> curr<span class="op">,</span> n<span class="op">,</span> delta_t<span class="op">);</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#     ifndef NO_OUTPUT</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#     pragma omp single</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>step <span class="op">%</span> output_freq <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>         Output_state<span class="op">(</span>t<span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#     endif</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-11" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb119"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>   finish <span class="op">=</span> omp_get_wtime<span class="op">();</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Elapsed time = %e seconds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> finish<span class="op">-</span>start<span class="op">);</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>curr<span class="op">);</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>forces<span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-12" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb120"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* main */</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function: Usage</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:  Print instructions for command-line and exit</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-13" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb121"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In arg<span class="op">:</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    prog_name<span class="op">:</span>  the name of the program as typed on the command<span class="op">-</span>line</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;usage: %s &lt;number of threads&gt; &lt;number of particles&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>         prog_name<span class="op">);</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;number of timesteps&gt; &lt;size of timestep&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-14" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb122"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;output frequency&gt; &lt;g|i&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;g&#39;: program should generate init conds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;i&#39;: program should get init conds from stdin</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>   exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Usage */</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-15" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb123"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Get_args</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Get command line args</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    argc:            number of command line args</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    argv:            command line args</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-16" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb124"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    thread_count_p<span class="op">:</span>  pointer to thread_count<span class="op">,</span> the number of threads</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_p<span class="op">:</span>             pointer to n<span class="op">,</span> the number of particles</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_steps_p<span class="op">:</span>       pointer to n_steps<span class="op">,</span> the number of timesteps</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    delta_t_p<span class="op">:</span>       pointer to delta_t<span class="op">,</span> the size of each timestep</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    output_freq_p<span class="op">:</span>   pointer to output_freq<span class="op">,</span> which is the number of</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     timesteps between steps whose output is printed</span></code></pre></div>
</section>
<section id="omp-osnovna-forma-17" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb125"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    g_i_p<span class="op">:</span>           pointer to <span class="dt">char</span> which is <span class="ch">&#39;g&#39;</span> <span class="cf">if</span> the init conds</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     should be generated by the program and <span class="ch">&#39;i&#39;</span> <span class="cf">if</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     they should be read from stdin</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> thread_count_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span> <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">7</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-18" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb126"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>thread_count_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>n_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>n_steps_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>delta_t_p <span class="op">=</span> strtod<span class="op">(</span>argv<span class="op">[</span><span class="dv">4</span><span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>output_freq_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">5</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>g_i_p <span class="op">=</span> argv<span class="op">[</span><span class="dv">6</span><span class="op">][</span><span class="dv">0</span><span class="op">];</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-19" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb127"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>thread_count_p <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>n_p <span class="op">&lt;=</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>n_steps_p <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>delta_t_p <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>      Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;g&#39;</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;thread_count = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>thread_count_p<span class="op">);</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;n = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_p<span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-20" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb128"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;n_steps = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_steps_p<span class="op">);</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;delta_t = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>delta_t_p<span class="op">);</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;output_freq = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>output_freq_p<span class="op">);</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;g_i = %c</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>g_i_p<span class="op">);</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_args */</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-21" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb129"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Get_init_cond</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Read in initial conditions:  mass, position and velocity</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co"> *            for each particle</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    n:      number of particles</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-22" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb130"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array of n structs<span class="op">,</span> each <span class="kw">struct</span> stores the mass <span class="op">(</span>scalar<span class="op">),</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position <span class="op">(</span>vector<span class="op">),</span> and velocity <span class="op">(</span>vector<span class="op">)</span> of a particle</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-23" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb131"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;For each particle, enter (in order):</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   its mass, its x-coord, its y-coord, &quot;</span><span class="op">);</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;its x-velocity, its y-velocity</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">);</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-24" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb132"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_init_cond */</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Gen_init_cond</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-25" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb133"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Generate initial conditions<span class="op">:</span>  mass<span class="op">,</span> position and velocity</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            <span class="cf">for</span> each particle</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array of n structs<span class="op">,</span> each <span class="kw">struct</span> stores the mass <span class="op">(</span>scalar<span class="op">),</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position <span class="op">(</span>vector<span class="op">),</span> and velocity <span class="op">(</span>vector<span class="op">)</span> of a particle</span></code></pre></div>
</section>
<section id="omp-osnovna-forma-26" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb134"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>      The initial conditions place all particles at</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            equal intervals on the nonnegative x<span class="op">-</span>axis with</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            identical masses<span class="op">,</span> and identical initial speeds</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            parallel to the y<span class="op">-</span>axis<span class="op">.</span>  However<span class="op">,</span> some of the</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            velocities are in the positive y<span class="op">-</span>direction and</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            some are negative<span class="op">.</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-27" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb135"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mass <span class="op">=</span> <span class="fl">5.0e24</span><span class="op">;</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> gap <span class="op">=</span> <span class="fl">1.0e5</span><span class="op">;</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> speed <span class="op">=</span> <span class="fl">3.0e4</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-28" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb136"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>   srandom<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>m <span class="op">=</span> mass<span class="op">;</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> part<span class="op">*</span>gap<span class="op">;</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="co">//    if (random()/((double) RAND_MAX) &gt;= 0.5)</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-29" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb137"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>part <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>         curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> speed<span class="op">;</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>         curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> <span class="op">-</span>speed<span class="op">;</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Gen_init_cond */</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-30" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb138"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Output_state</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Print the current state of the system</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    curr:   array with n elements, curr[i] stores the state (mass,</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *            position and velocity) of the ith particle</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-31" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb139"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;%.2f</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> time<span class="op">);</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="co">//    printf(&quot;%.3f &quot;, curr[part].m);</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-32" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb140"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;%3d %10.3e &quot;</span><span class="op">,</span> part<span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Output_state */</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-33" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb141"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Compute_force</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Compute the total force on particle part.</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    part:   the particle on which we&#39;re computing the total force</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-34" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb142"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   current state of the system<span class="op">:</span>  curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position and velocity of the ith particle</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out arg<span class="op">:</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    forces<span class="op">:</span> force<span class="op">[</span>i<span class="op">]</span> stores the total force on the ith particle</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span> This function uses the force due to gravitation<span class="op">.</span>  So</span></code></pre></div>
</section>
<section id="omp-osnovna-forma-35" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb143"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> the force on particle i due to particle k is given by</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    m_i m_k <span class="op">(</span>s_k <span class="op">-</span> s_i<span class="op">)/|</span>s_k <span class="op">-</span> s_i<span class="op">|^</span><span class="dv">2</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Here<span class="op">,</span> m_j is the mass of particle j and s_k is its position vector</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> <span class="op">(</span>at time t<span class="op">).</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-36" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb144"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> k<span class="op">;</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mg<span class="op">;</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>   vect_t f_part_k<span class="op">;</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> len<span class="op">,</span> len_3<span class="op">,</span> fact<span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-37" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb145"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Current total force on particle %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>         part<span class="op">,</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">],</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>   forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">=</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> n<span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>k <span class="op">!=</span> part<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-38" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb146"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* Compute force on part due to k */</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>k<span class="op">].</span>s<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>k<span class="op">].</span>s<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>         len <span class="op">=</span> sqrt<span class="op">(</span>f_part_k<span class="op">[</span>X<span class="op">]*</span>f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> f_part_k<span class="op">[</span>Y<span class="op">]*</span>f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>         len_3 <span class="op">=</span> len<span class="op">*</span>len<span class="op">*</span>len<span class="op">;</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>         mg <span class="op">=</span> <span class="op">-</span>G<span class="op">*</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">*</span>curr<span class="op">[</span>k<span class="op">].</span>m<span class="op">;</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>         fact <span class="op">=</span> mg<span class="op">/</span>len_3<span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-39" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb147"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>   <span class="pp">#     ifdef DEBUG</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;Force on particle %d due to particle %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>               part<span class="op">,</span> k<span class="op">,</span> f_part_k<span class="op">[</span>X<span class="op">],</span> f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>   <span class="pp">#     endif</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-40" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb148"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>         <span class="co">/* Add force in to total forces */</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>         forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>         forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_force */</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-41" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb149"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Update_part</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Update the velocity and position for particle part</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    part:    the particle we&#39;re updating</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    forces:  forces[i] stores the total force on the ith particle</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-42" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb150"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       number of particles</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In<span class="op">/</span>out arg<span class="op">:</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>    curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span> position and velocity of the</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>             ith particle</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>  This version uses Euler&#39;s method to update both the velocity</span></code></pre></div>
</section>
<section id="omp-osnovna-forma-43" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb151"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    and the position<span class="op">.</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> fact <span class="op">=</span> delta_t<span class="op">/</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">;</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-44" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb152"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Before update of %d:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> part<span class="op">);</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Position  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Velocity  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Net force = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">],</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">];</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-45" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb153"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">];</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Position of %d = (%.3e, %.3e), Velocity = (%.3e,%.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>         part<span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">],</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>               curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-46" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb154"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">// curr[part].s[X] += delta_t * curr[part].v[X];</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="co">// curr[part].s[Y] += delta_t * curr[part].v[Y];</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Update_part */</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Compute_energy</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-47" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb155"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Compute the kinetic and potential energy in the system</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   current state of the system<span class="op">,</span> curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position and velocity of the ith particle</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    kin_en_p<span class="op">:</span> pointer to kinetic energy of system</span></code></pre></div>
</section>
<section id="omp-osnovna-forma-48" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb156"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pot_en_p<span class="op">:</span> pointer to potential energy of system</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_energy<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span><span class="op">*</span> kin_en_p<span class="op">,</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> pot_en_p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> i<span class="op">,</span> j<span class="op">;</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>   vect_t diff<span class="op">;</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> pe <span class="op">=</span> <span class="fl">0.0</span><span class="op">,</span> ke <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-49" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb157"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> dist<span class="op">,</span> speed_sqr<span class="op">;</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>      speed_sqr <span class="op">=</span> curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>X<span class="op">]*</span>curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]*</span>curr<span class="op">[</span>i<span class="op">].</span>v<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>      ke <span class="op">+=</span> curr<span class="op">[</span>i<span class="op">].</span>m<span class="op">*</span>speed_sqr<span class="op">;</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>   ke <span class="op">*=</span> <span class="fl">0.5</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-50" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb158"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">-</span><span class="dv">1</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>j <span class="op">=</span> i<span class="op">+</span><span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> n<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>         diff<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>i<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>j<span class="op">].</span>s<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>         diff<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>i<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>j<span class="op">].</span>s<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>         dist <span class="op">=</span> sqrt<span class="op">(</span>diff<span class="op">[</span>X<span class="op">]*</span>diff<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> diff<span class="op">[</span>Y<span class="op">]*</span>diff<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>         pe <span class="op">+=</span> <span class="op">-</span>G<span class="op">*</span>curr<span class="op">[</span>i<span class="op">].</span>m<span class="op">*</span>curr<span class="op">[</span>j<span class="op">].</span>m<span class="op">/</span>dist<span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-osnovna-forma-51" class="slide level2">
<h2>OMP Osnovna forma</h2>
<div class="sourceCode" id="cb159"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>kin_en_p <span class="op">=</span> ke<span class="op">;</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>pot_en_p <span class="op">=</span> pe<span class="op">;</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_energy */</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb160"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;omp.h&gt;</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-1" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb161"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DIM 2  </span><span class="co">/* Two-dimensional system */</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define X 0    </span><span class="co">/* x-coordinate subscript */</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define Y 1    </span><span class="co">/* y-coordinate subscript */</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">double</span> G <span class="op">=</span> <span class="fl">6.673e-11</span><span class="op">;</span>  <span class="co">/* Gravitational constant. */</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>                             <span class="co">/* Units are m^3/(kg*s^2)  */</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-2" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb162"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">double</span> vect_t<span class="op">[</span>DIM<span class="op">];</span>  <span class="co">/* Vector type for position, etc. */</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> particle_s <span class="op">{</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> m<span class="op">;</span>  <span class="co">/* Mass     */</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>   vect_t s<span class="op">;</span>  <span class="co">/* Position */</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>   vect_t v<span class="op">;</span>  <span class="co">/* Velocity */</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-3" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb163"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">);</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> thread_count_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span> <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">);</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-4" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb164"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">);</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">);</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*--------------------------------------------------------------------*/</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-5" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb165"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n<span class="op">;</span>                      <span class="co">/* Number of particles              */</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n_steps<span class="op">;</span>                <span class="co">/* Number of timesteps              */</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> step<span class="op">;</span>                   <span class="co">/* Current step                     */</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span>                   <span class="co">/* Current particle                 */</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> output_freq<span class="op">;</span>            <span class="co">/* Frequency of output              */</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> delta_t<span class="op">;</span>             <span class="co">/* Size of timestep                 */</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> t<span class="op">;</span>                   <span class="co">/* Current Time                     */</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-6" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb166"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>   <span class="kw">struct</span> particle_s<span class="op">*</span> curr<span class="op">;</span>    <span class="co">/* Current state of system          */</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> forces<span class="op">;</span>             <span class="co">/* Forces on each particle          */</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> thread_count<span class="op">;</span>           <span class="co">/* Number of threads                */</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">char</span> g_i<span class="op">;</span>                   <span class="co">/* _G_enerate or _i_nput init conds */</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> start<span class="op">,</span> finish<span class="op">;</span>       <span class="co">/* For timing                       */</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> loc_forces<span class="op">;</span>         <span class="co">/* Forces computed by each thread   */</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-7" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb167"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>   Get_args<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">,</span> <span class="op">&amp;</span>thread_count<span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>n_steps<span class="op">,</span> <span class="op">&amp;</span>delta_t<span class="op">,</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>         <span class="op">&amp;</span>output_freq<span class="op">,</span> <span class="op">&amp;</span>g_i<span class="op">);</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>   curr <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> particle_s<span class="op">));</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>   forces <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>   loc_forces <span class="op">=</span> malloc<span class="op">(</span>thread_count<span class="op">*</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>g_i <span class="op">==</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>      Get_init_cond<span class="op">(</span>curr<span class="op">,</span> n<span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-8" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb168"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>      Gen_init_cond<span class="op">(</span>curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>   start <span class="op">=</span> omp_get_wtime<span class="op">();</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifndef NO_OUTPUT</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>   Output_state<span class="op">(</span><span class="dv">0</span><span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-9" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb169"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#  pragma omp parallel num_threads(thread_count) default(none) \</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="pp">      shared(curr,forces,thread_count,delta_t,n,n_steps, \</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="pp">            output_freq,loc_forces) \</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="pp">      private(step, part, t)</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> my_rank <span class="op">=</span> omp_get_thread_num<span class="op">();</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> thread<span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-10" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb170"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>step <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> step <span class="op">&lt;=</span> n_steps<span class="op">;</span> step<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>         t <span class="op">=</span> step<span class="op">*</span>delta_t<span class="op">;</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="co">//       memset(loc_forces + my_rank*n, 0, n*sizeof(vect_t));</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#        pragma omp for</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> thread_count<span class="op">*</span>n<span class="op">;</span> part<span class="op">++)</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>            loc_forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">=</span> loc_forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-11" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb171"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#        ifdef DEBUG</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#        pragma omp single</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;Step %d, after memset loc_forces = </span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> step<span class="op">);</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> thread_count<span class="op">*</span>n<span class="op">;</span> part<span class="op">++)</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>               printf<span class="op">(</span><span class="st">&quot;%d %e %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> part<span class="op">,</span> loc_forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">],</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>                  loc_forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-12" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb172"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#        endif</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>         <span class="co">/* Particle n-1 will have all forces computed after call to</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="co">          * Compute_force(n-2, . . .) */</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#        pragma omp for schedule(static,1)</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">-</span><span class="dv">1</span><span class="op">;</span> part<span class="op">++)</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-13" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb173"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>            Compute_force<span class="op">(</span>part<span class="op">,</span> loc_forces <span class="op">+</span> my_rank<span class="op">*</span>n<span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#        pragma omp for</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>            forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">=</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span>thread <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> thread <span class="op">&lt;</span> thread_count<span class="op">;</span> thread<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>               forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> loc_forces<span class="op">[</span>thread<span class="op">*</span>n <span class="op">+</span> part<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>               forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> loc_forces<span class="op">[</span>thread<span class="op">*</span>n <span class="op">+</span> part<span class="op">][</span>Y<span class="op">];</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-14" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb174"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#        pragma omp for</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>            Update_part<span class="op">(</span>part<span class="op">,</span> forces<span class="op">,</span> curr<span class="op">,</span> n<span class="op">,</span> delta_t<span class="op">);</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#        ifndef NO_OUTPUT</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>step <span class="op">%</span> output_freq <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-15" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb175"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#           pragma omp single</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>            Output_state<span class="op">(</span>t<span class="op">,</span> curr<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#        endif</span></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span>  <span class="co">/* for step */</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span>  <span class="co">/* pragma omp parallel */</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>   finish <span class="op">=</span> omp_get_wtime<span class="op">();</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-16" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb176"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Elapsed time = %e seconds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> finish<span class="op">-</span>start<span class="op">);</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>curr<span class="op">);</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>forces<span class="op">);</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>loc_forces<span class="op">);</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* main */</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-17" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb177"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function: Usage</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:  Print instructions for command-line and exit</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * In arg:</span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    prog_name:  the name of the program as typed on the command-line</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-18" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb178"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;usage: %s &lt;number of threads&gt; &lt;number of particles&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>         prog_name<span class="op">);</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;number of timesteps&gt;  &lt;size of timestep&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;output frequency&gt; &lt;g|i&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;g&#39;: program should generate init conds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;i&#39;: program should get init conds from stdin</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-19" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb179"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>   exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Usage */</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Get_args</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-20" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb180"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Get command line args</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    argc<span class="op">:</span>            number of command line args</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    argv<span class="op">:</span>            command line args</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    thread_count_p<span class="op">:</span>  pointer to thread_count</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_p<span class="op">:</span>             pointer to n<span class="op">,</span> the number of particles</span></code></pre></div>
</section>
<section id="omp-redukovana-forma-21" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb181"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_steps_p<span class="op">:</span>       pointer to n_steps<span class="op">,</span> the number of timesteps</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    delta_t_p<span class="op">:</span>       pointer to delta_t<span class="op">,</span> the size of each timestep</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    output_freq_p<span class="op">:</span>   pointer to output_freq<span class="op">,</span> which is the number of</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     timesteps between steps whose output is printed</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    g_i_p<span class="op">:</span>           pointer to <span class="dt">char</span> which is <span class="ch">&#39;g&#39;</span> <span class="cf">if</span> the init conds</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     should be generated by the program and <span class="ch">&#39;i&#39;</span> <span class="cf">if</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     they should be read from stdin</span></code></pre></div>
</section>
<section id="omp-redukovana-forma-22" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb182"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> thread_count_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span> <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">7</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>thread_count_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>n_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-23" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb183"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>n_steps_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>delta_t_p <span class="op">=</span> strtod<span class="op">(</span>argv<span class="op">[</span><span class="dv">4</span><span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>output_freq_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">5</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">*</span>g_i_p <span class="op">=</span> argv<span class="op">[</span><span class="dv">6</span><span class="op">][</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>thread_count_p <span class="op">&lt;=</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>n_p <span class="op">&lt;=</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>n_steps_p <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>       <span class="op">*</span>delta_t_p <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-24" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb184"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;g&#39;</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;thread_count = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>thread_count_p<span class="op">);</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;n = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_p<span class="op">);</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;n_steps = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_steps_p<span class="op">);</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;delta_t = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>delta_t_p<span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-25" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb185"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;output_freq = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>output_freq_p<span class="op">);</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;g_i = %c</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>g_i_p<span class="op">);</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_args */</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Get_init_cond</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-26" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb186"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Read in initial conditions<span class="op">:</span>  mass<span class="op">,</span> position and velocity</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            <span class="cf">for</span> each particle</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array of n structs<span class="op">,</span> each <span class="kw">struct</span> stores the mass <span class="op">(</span>scalar<span class="op">),</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position <span class="op">(</span>vector<span class="op">),</span> and velocity <span class="op">(</span>vector<span class="op">)</span> of a particle</span></code></pre></div>
</section>
<section id="omp-redukovana-forma-27" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb187"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;For each particle, enter (in order):</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   its mass, its x-coord, its y-coord, &quot;</span><span class="op">);</span></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;its x-velocity, its y-velocity</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-28" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb188"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">);</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>      scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-29" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb189"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_init_cond */</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Gen_init_cond</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Generate initial conditions:  mass, position and velocity</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *            for each particle</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-30" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb190"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array of n structs<span class="op">,</span> each <span class="kw">struct</span> stores the mass <span class="op">(</span>scalar<span class="op">),</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position <span class="op">(</span>vector<span class="op">),</span> and velocity <span class="op">(</span>vector<span class="op">)</span> of a particle</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>      The initial conditions place all particles at</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            equal intervals on the nonnegative x<span class="op">-</span>axis with</span></code></pre></div>
</section>
<section id="omp-redukovana-forma-31" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb191"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            identical masses<span class="op">,</span> and identical initial speeds</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            parallel to the y<span class="op">-</span>axis<span class="op">.</span>  However<span class="op">,</span> some of the</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            velocities are in the positive y<span class="op">-</span>direction and</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            some are negative<span class="op">.</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-32" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb192"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mass <span class="op">=</span> <span class="fl">5.0e24</span><span class="op">;</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> gap <span class="op">=</span> <span class="fl">1.0e5</span><span class="op">;</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> speed <span class="op">=</span> <span class="fl">3.0e4</span><span class="op">;</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>   srandom<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>m <span class="op">=</span> mass<span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-33" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb193"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> part<span class="op">*</span>gap<span class="op">;</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>      curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="co">//    if (random()/((double) RAND_MAX) &gt;= 0.5)</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>part <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>         curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> speed<span class="op">;</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-34" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb194"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>         curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> <span class="op">-</span>speed<span class="op">;</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Gen_init_cond */</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Output_state</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Print the current state of the system</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-35" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb195"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   array with n elements<span class="op">,</span> curr<span class="op">[</span>i<span class="op">]</span> stores the state <span class="op">(</span>mass<span class="op">,</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position and velocity<span class="op">)</span> of the ith particle</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-36" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb196"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;%.2f</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> time<span class="op">);</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="co">//    printf(&quot;%.3e &quot;, curr[part].m);</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;%3d %10.3e &quot;</span><span class="op">,</span> part<span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]);</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;  %10.3e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-37" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb197"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Output_state */</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Compute_force</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-38" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb198"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Compute the total force on particle part<span class="op">.</span>  Exploit</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            the symmetry <span class="op">(</span>force on particle i due to particle k<span class="op">)</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            <span class="op">=</span> <span class="op">-(</span>force on particle k due to particle i<span class="op">)</span> to also</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            calculate partial forces on other particles<span class="op">.</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    part<span class="op">:</span>   the particle on which we&#39;re computing the total force</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>   current state of the system<span class="op">:</span>  curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-39" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb199"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            position and velocity of the ith particle</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>      number of particles</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out arg<span class="op">:</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    forces<span class="op">:</span> force<span class="op">[</span>i<span class="op">]</span> stores the total force on the ith particle</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span> This function uses the force due to gravitation<span class="op">.</span>  So</span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> the force on particle i due to particle k is given by</span></code></pre></div>
</section>
<section id="omp-redukovana-forma-40" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb200"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    m_i m_k <span class="op">(</span>s_k <span class="op">-</span> s_i<span class="op">)/|</span>s_k <span class="op">-</span> s_i<span class="op">|^</span><span class="dv">2</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Here<span class="op">,</span> m_j is the mass of particle j and s_k is its position vector</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> <span class="op">(</span>at time t<span class="op">).</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-41" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb201"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> k<span class="op">;</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mg<span class="op">;</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>   vect_t f_part_k<span class="op">;</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> len<span class="op">,</span> len_3<span class="op">,</span> fact<span class="op">;</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-42" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb202"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Current total force on particle %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>         part<span class="op">,</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">],</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>k <span class="op">=</span> part<span class="op">+</span><span class="dv">1</span><span class="op">;</span> k <span class="op">&lt;</span> n<span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* Compute force on part due to k */</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>      f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>k<span class="op">].</span>s<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>      f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">-</span> curr<span class="op">[</span>k<span class="op">].</span>s<span class="op">[</span>Y<span class="op">];</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-43" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb203"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>      len <span class="op">=</span> sqrt<span class="op">(</span>f_part_k<span class="op">[</span>X<span class="op">]*</span>f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> f_part_k<span class="op">[</span>Y<span class="op">]*</span>f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>      len_3 <span class="op">=</span> len<span class="op">*</span>len<span class="op">*</span>len<span class="op">;</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>      mg <span class="op">=</span> <span class="op">-</span>G<span class="op">*</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">*</span>curr<span class="op">[</span>k<span class="op">].</span>m<span class="op">;</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>      fact <span class="op">=</span> mg<span class="op">/</span>len_3<span class="op">;</span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>      f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>      f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#     ifdef DEBUG</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-44" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb204"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;Force on particle %d due to particle %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>            part<span class="op">,</span> k<span class="op">,</span> f_part_k<span class="op">[</span>X<span class="op">],</span> f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#     endif</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* Add force into total forces */</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>      forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>      forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>Y<span class="op">];</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-45" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb205"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>      forces<span class="op">[</span>k<span class="op">][</span>X<span class="op">]</span> <span class="op">-=</span> f_part_k<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>      forces<span class="op">[</span>k<span class="op">][</span>Y<span class="op">]</span> <span class="op">-=</span> f_part_k<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_force */</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-46" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb206"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Function<span class="op">:</span>  Update_part</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Update the velocity and position <span class="cf">for</span> particle part</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    part<span class="op">:</span>    the particle we&#39;re updating</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    forces<span class="op">:</span>  forces<span class="op">[</span>i<span class="op">]</span> stores the total force on the ith particle</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       number of particles</span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-47" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb207"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In<span class="op">/</span>out arg<span class="op">:</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    curr<span class="op">:</span>    curr<span class="op">[</span>i<span class="op">]</span> stores the mass<span class="op">,</span> position and velocity of the</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>             ith particle</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>  This version uses Euler&#39;s method to update both the velocity</span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    and the position<span class="op">.</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-48" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb208"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> part<span class="op">,</span> vect_t forces<span class="op">[],</span> <span class="kw">struct</span> particle_s curr<span class="op">[],</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> fact <span class="op">=</span> delta_t<span class="op">/</span>curr<span class="op">[</span>part<span class="op">].</span>m<span class="op">;</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Before update of %d:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> part<span class="op">);</span></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Position  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]);</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-49" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb209"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Velocity  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Net force = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">],</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> forces<span class="op">[</span>part<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>   curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> forces<span class="op">[</span>part<span class="op">][</span>Y<span class="op">];</span></span></code></pre></div>
</section>
<section id="omp-redukovana-forma-50" class="slide level2">
<h2>OMP Redukovana forma</h2>
<div class="sourceCode" id="cb210"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Position of %d = (%.3e, %.3e), Velocity = (%.3e,%.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>         part<span class="op">,</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>s<span class="op">[</span>Y<span class="op">],</span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>               curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>X<span class="op">],</span> curr<span class="op">[</span>part<span class="op">].</span>v<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section></section>
<section>
<section id="diskusija-paralelizacije-u-modelu-distribuirane-memorije" class="title-slide slide level1">
<h1>Diskusija paralelizacije u modelu distribuirane memorije</h1>
<p>Problem n tela</p>
</section>
<section id="openmpi-paralelizacija" class="slide level2">
<h2>OpenMPI paralelizacija</h2>
<ul>
<li>Centralna ideja se ne razlikuje dramatično u odnosu na OpenMP paralelizaciju.</li>
<li>Ključan korak, kao i ranije, jeste kako individualne niti (koje su sada na različitim mašinama) komuniciraju.</li>
<li>Fundamentalna podela posla, opet, radi na nivou individualnih čestica.</li>
<li>Ako govorimo o ne-redukovanom algoritmu, onda komunikacija nastaje u okviru računanja sile između i-te i j-te čestice.</li>
<li>To znači da u svakom koraku, svaka čestica zahteva poziciju svake druge čestice (manje-više).</li>
<li>Ovo je dušu dalo za <code>MPI_Allgather</code> operaciju.</li>
</ul>
</section>
<section id="tehnički-detalji-struktura-podataka" class="slide level2">
<h2>Tehnički detalji struktura podataka</h2>
<ul>
<li>Pod MPI umesto struct-a koristimo nizove elementarnih tipova zato što je komunikacija kroz elementarne tipove najbrža.</li>
<li>Takođe, niz masa držimo unapred kopiranim na sve instance zato što se mase nikad ne menjaju, a uvek su neophodne.</li>
<li>Najbolji način da razrešimo distribuciju podataka jeste kroz blokove pozicija za koje smo odgovorni (pozicije su ono što moramo da delimo iz koraka u korak) gde svaka nit pamti koji je njen blok kroz pokazivače i fiksnu veličinu bloka.</li>
</ul>
</section>
<section id="opšta-struktura-ne-redukovanog-algoritma" class="slide level2">
<h2>Opšta struktura ne-redukovanog algoritma</h2>
<p><img data-src="img/2022-12-12-15-10-34.png" /></p>
</section>
<section id="mpi-implementacija-redukovanog-algoritma" class="slide level2">
<h2>MPI implementacija redukovanog algoritma</h2>
<ul>
<li>Redukovani algoritam je jako problematičan za implementaciju u MPI okruženju.</li>
<li>Problem je kako proslediti prave informacije u pravom trenutku.
<ul>
<li>Svaki proces je odgovoran za neke čestice, ali ne računa sve sile za te čestice. Neke sile će računati neko drugi.</li>
<li>To znači da u svakom koraku moramo i da emitujemo naše sile drugim procesima i da dobijemo sile od negde drugde samo da bi mogli da sračunamo sledeću generaciju pozicija.</li>
</ul></li>
<li>Ovo je jako kompleksno, ali ako se implementira kako treba je šansa za istinski skalabilan i efikasan proces za računanje proizvoljno velikih n-tela simulacija.</li>
</ul>
</section>
<section id="prstenska-komunikaciona-šema" class="slide level2">
<h2>Prstenska komunikaciona šema</h2>
<ul>
<li>Prstenska komunikaciona šema je stari trik u komunikacionoj topologiji da se pojednostavi i regularizuje komunikacija.</li>
<li>U praksi, svaki čvor može da komunicira sa svakim drugim čvorom na bilo koji način, bilo kada, sa bilo kojim sadržajem.</li>
<li>Ova sloboda znači da ništa ne može, <em>a priori,</em> da se kaže o toj komunikaciji, ona nema osobine, i o njoj se ne može baš puno rezonovati: suviše je nedefinisano.</li>
<li>Problem do koga ovo ultimativno dovede jeste da ne možemo da optimizujemo komunikaciju zato što je ne razumemo.</li>
<li>Rešenje jeste da se koriste obrasci gde ograničenja stvaraju strukturu.</li>
</ul>
</section>
<section id="prstenska-komunikaciona-šema-1" class="slide level2">
<h2>Prstenska komunikaciona šema</h2>
<ul>
<li>U ovoj šemi zamislimo sve MPI procese (njih <code>q</code>) u prstenu.</li>
<li>Zatim ih povežemo vodeći računa o ograničenju da p-ti proces samo komunicira sa procesima <code>p-1</code> i <code>p+1</code> ili, da bi bili nešto tačniji, sa <code>(p - 1 + q) % q</code> i <code>(p+1) % q</code> (što se samo stara da se očuva prstenasta topologija.</li>
<li>U okviru komunikacije važi pipeline princip: komunikacija je sinhronizovana i to tako da <code>p</code> prima podatke od <code>p-1</code> i šalje ih <code>p+1</code></li>
<li>Posle q faza komunikacije, svi imaju sve podatke.</li>
</ul>
</section>
<section id="paralelizacija-redukovanog-algoritma-kroz-mpi" class="slide level2">
<h2>Paralelizacija redukovanog algoritma kroz MPI</h2>
<ul>
<li>Neka je broj čestica dodeljenih jednom procesu <code>l</code></li>
<li>Onda u našoj prstenskoj strukturi u svakoj fazi komunikacije svaki proces:
<ul>
<li>Šalje dalje l sila i l pozicija (svojih)</li>
<li>Proračuna silu između svojih čestica i onih čije pozicije primi.</li>
<li>Doda te sile svojim česticama i oduzme ih od sila koje dobije.</li>
</ul></li>
</ul>
</section>
<section id="primer-prstenskog-stila-komunikacije-za-n4-p2" class="slide level2">
<h2>Primer prstenskog stila komunikacije za n=4, p=2</h2>
<p><img data-src="img/2022-12-12-15-13-20.png" /></p>
</section>
<section id="primer-prstenskog-stila-komunikacije-za-n4-p2-1" class="slide level2">
<h2>Primer prstenskog stila komunikacije za n=4, p=2</h2>
<p><img data-src="img/2022-12-12-15-13-40.png" /></p>
</section>
<section id="tehnički-detalji-komunikacije" class="slide level2">
<h2>Tehnički detalji komunikacije</h2>
<ul>
<li>Dovoljno je često programirati ovako da se podaci istovremeno šalju i primaju da postoji funkcija koja nam štedi memoriju za takav tip komunikacije: <code>MPI_Sendrecv_replace</code> čiji su parametri:
<ul>
<li>ulazno izlazni bafer</li>
<li>veličina bafera</li>
<li>tip podataka</li>
<li>odredište</li>
<li>tag</li>
<li>izvor</li>
<li>tag</li>
<li>kanal</li>
<li>izlazni status</li>
</ul></li>
</ul>
</section>
<section id="mpi_sendrecv_replace" class="slide level2">
<h2><code>MPI_Sendrecv_replace</code></h2>
<ul>
<li><code>MPI_Sendrecv_replace</code> istovremeno šalje podatke u baferu i prima istu količinu podataka.</li>
<li>Kada se završi, podaci koji su bili u baferu su odaslati dalje, a podaci koji su stigli su smešteni u bafer.</li>
</ul>
</section>
<section id="ako-želite-još-informacija" class="slide level2">
<h2>Ako želite još informacija</h2>
<ul>
<li>Vrlo dobar pregled problema N tela se može naći u Grop, Lusk, i Skjellum — Using MPI: Portable Parallel Programming with the Message Passing Interface u sekciji 5.2.</li>
<li>Više o efikasnoj integraciji diferencijalnih jednačina ima u: William H. Press, Saul A. Teukolsky, William T. Vetterling, and Brian P. Flannery. 2007. Numerical Recipes 3rd Edition: The Art of Scientific Computing (3 ed.). Cambridge University Press, New York, NY, USA. i to u poglavlju 17, stranica 899. Naročito obratite pažnju na sekcije 17.0 i 17.1.</li>
</ul>
</section></section>
<section>
<section id="implementacija-paralelizacije-u-modelu-distribuirane-memorije" class="title-slide slide level1">
<h1>Implementacija paralelizacije u modelu distribuirane memorije</h1>
<p>Problem n tela</p>
</section>
<section id="mpi-osnovna-forma" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb211"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;mpi.h&gt;</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-1" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb212"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DIM 2  </span><span class="co">/* Two-dimensional system */</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define X 0    </span><span class="co">/* x-coordinate subscript */</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define Y 1    </span><span class="co">/* y-coordinate subscript */</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">double</span> vect_t<span class="op">[</span>DIM<span class="op">];</span>  <span class="co">/* Vector type for position, etc. */</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="co">/* Global variables.  Except or vel all are unchanged after being set */</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-2" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb213"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">double</span> G <span class="op">=</span> <span class="fl">6.673e-11</span><span class="op">;</span>  <span class="co">/* Gravitational constant. */</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>                             <span class="co">/* Units are m^3/(kg*s^2)  */</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> my_rank<span class="op">,</span> comm_sz<span class="op">;</span></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>MPI_Comm comm<span class="op">;</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>MPI_Datatype vect_mpi_t<span class="op">;</span></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="co">/* Scratch array used by process 0 for global velocity I/O */</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-3" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb214"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>vect_t <span class="op">*</span>vel <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">);</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">);</span></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t pos<span class="op">[],</span></span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-4" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb215"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t pos<span class="op">[],</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">);</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t pos<span class="op">[],</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">);</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> loc_part<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_forces<span class="op">[],</span></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>      vect_t pos<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">);</span></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> loc_part<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_forces<span class="op">[],</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-5" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb216"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>      vect_t loc_pos<span class="op">[],</span> vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">);</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*--------------------------------------------------------------------*/</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n<span class="op">;</span>                      <span class="co">/* Total number of particles  */</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> loc_n<span class="op">;</span>                  <span class="co">/* Number of my particles     */</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n_steps<span class="op">;</span>                <span class="co">/* Number of timesteps        */</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-6" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb217"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> step<span class="op">;</span>                   <span class="co">/* Current step               */</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> loc_part<span class="op">;</span>               <span class="co">/* Current local particle     */</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> output_freq<span class="op">;</span>            <span class="co">/* Frequency of output        */</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> delta_t<span class="op">;</span>             <span class="co">/* Size of timestep           */</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> t<span class="op">;</span>                   <span class="co">/* Current Time               */</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span><span class="op">*</span> masses<span class="op">;</span>             <span class="co">/* All the masses             */</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> loc_pos<span class="op">;</span>            <span class="co">/* Positions of my particles  */</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-7" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb218"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> pos<span class="op">;</span>                <span class="co">/* Positions of all particles */</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> loc_vel<span class="op">;</span>            <span class="co">/* Velocities of my particles */</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> loc_forces<span class="op">;</span>         <span class="co">/* Forces on my particles     */</span></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">char</span> g_i<span class="op">;</span>                   <span class="co">/*_G_en or _i_nput init conds */</span></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> start<span class="op">,</span> finish<span class="op">;</span>       <span class="co">/* For timings                */</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-8" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb219"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>   MPI_Init<span class="op">(&amp;</span>argc<span class="op">,</span> <span class="op">&amp;</span>argv<span class="op">);</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>   comm <span class="op">=</span> MPI_COMM_WORLD<span class="op">;</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>   MPI_Comm_size<span class="op">(</span>comm<span class="op">,</span> <span class="op">&amp;</span>comm_sz<span class="op">);</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>   MPI_Comm_rank<span class="op">(</span>comm<span class="op">,</span> <span class="op">&amp;</span>my_rank<span class="op">);</span></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>   Get_args<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>n_steps<span class="op">,</span> <span class="op">&amp;</span>delta_t<span class="op">,</span> <span class="op">&amp;</span>output_freq<span class="op">,</span> <span class="op">&amp;</span>g_i<span class="op">);</span></span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a>   loc_n <span class="op">=</span> n<span class="op">/</span>comm_sz<span class="op">;</span>  <span class="co">/* n should be evenly divisible by comm_sz */</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-9" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb220"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>   masses <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>   pos <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>   loc_forces <span class="op">=</span> malloc<span class="op">(</span>loc_n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>   loc_pos <span class="op">=</span> pos <span class="op">+</span> my_rank<span class="op">*</span>loc_n<span class="op">;</span></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>   loc_vel <span class="op">=</span> malloc<span class="op">(</span>loc_n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> vel <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>   MPI_Type_contiguous<span class="op">(</span>DIM<span class="op">,</span> MPI_DOUBLE<span class="op">,</span> <span class="op">&amp;</span>vect_mpi_t<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-10" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb221"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>   MPI_Type_commit<span class="op">(&amp;</span>vect_mpi_t<span class="op">);</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>g_i <span class="op">==</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>      Get_init_cond<span class="op">(</span>masses<span class="op">,</span> pos<span class="op">,</span> loc_vel<span class="op">,</span> n<span class="op">,</span> loc_n<span class="op">);</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>      Gen_init_cond<span class="op">(</span>masses<span class="op">,</span> pos<span class="op">,</span> loc_vel<span class="op">,</span> n<span class="op">,</span> loc_n<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-11" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb222"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>   start <span class="op">=</span> MPI_Wtime<span class="op">();</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifndef NO_OUTPUT</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>   Output_state<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> masses<span class="op">,</span> pos<span class="op">,</span> loc_vel<span class="op">,</span> n<span class="op">,</span> loc_n<span class="op">);</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>step <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> step <span class="op">&lt;=</span> n_steps<span class="op">;</span> step<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>      t <span class="op">=</span> step<span class="op">*</span>delta_t<span class="op">;</span></span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>loc_part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> loc_part <span class="op">&lt;</span> loc_n<span class="op">;</span> loc_part<span class="op">++)</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-12" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb223"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>         Compute_force<span class="op">(</span>loc_part<span class="op">,</span> masses<span class="op">,</span> loc_forces<span class="op">,</span> pos<span class="op">,</span> n<span class="op">,</span> loc_n<span class="op">);</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>loc_part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> loc_part <span class="op">&lt;</span> loc_n<span class="op">;</span> loc_part<span class="op">++)</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>         Update_part<span class="op">(</span>loc_part<span class="op">,</span> masses<span class="op">,</span> loc_forces<span class="op">,</span> loc_pos<span class="op">,</span> loc_vel<span class="op">,</span></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>               n<span class="op">,</span> loc_n<span class="op">,</span> delta_t<span class="op">);</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>      MPI_Allgather<span class="op">(</span>MPI_IN_PLACE<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>                    pos<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#     ifndef NO_OUTPUT</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-13" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb224"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>step <span class="op">%</span> output_freq <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>         Output_state<span class="op">(</span>t<span class="op">,</span> masses<span class="op">,</span> pos<span class="op">,</span> loc_vel<span class="op">,</span> n<span class="op">,</span> loc_n<span class="op">);</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#     endif</span></span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>   finish <span class="op">=</span> MPI_Wtime<span class="op">();</span></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-14" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb225"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;Elapsed time = %e seconds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> finish<span class="op">-</span>start<span class="op">);</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>   MPI_Type_free<span class="op">(&amp;</span>vect_mpi_t<span class="op">);</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>masses<span class="op">);</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>pos<span class="op">);</span></span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>loc_forces<span class="op">);</span></span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>loc_vel<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-15" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb226"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> free<span class="op">(</span>vel<span class="op">);</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>   MPI_Finalize<span class="op">();</span></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* main */</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-16" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb227"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function: Usage</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:  Print instructions for command-line and exit</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * In arg:</span></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    prog_name:  the name of the program as typed on the command-line</span></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-17" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb228"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;usage: mpiexec -n &lt;number of processes&gt; %s</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> prog_name<span class="op">);</span></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;number of particles&gt; &lt;number of timesteps&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;size of timestep&gt; &lt;output frequency&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;g|i&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;g&#39;: program should generate init conds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-18" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb229"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;i&#39;: program should get init conds from stdin</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>   exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Usage */</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-19" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb230"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Function<span class="op">:</span>  Get_args</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Get command line args</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    argc<span class="op">:</span>            number of command line args</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    argv<span class="op">:</span>            command line args</span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_p<span class="op">:</span>             pointer to n<span class="op">,</span> the number of particles</span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-20" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb231"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_steps_p<span class="op">:</span>       pointer to n_steps<span class="op">,</span> the number of timesteps</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    delta_t_p<span class="op">:</span>       pointer to delta_t<span class="op">,</span> the size of each timestep</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    output_freq_p<span class="op">:</span>   pointer to output_freq<span class="op">,</span> which is the number of</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     timesteps between steps whose output is printed</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    g_i_p<span class="op">:</span>           pointer to <span class="dt">char</span> which is <span class="ch">&#39;g&#39;</span> <span class="cf">if</span> the init conds</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     should be generated by the program and <span class="ch">&#39;i&#39;</span> <span class="cf">if</span></span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     they should be read from stdin</span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-21" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb232"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">6</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">*</span>n_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">*</span>n_steps_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-22" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb233"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>      <span class="op">*</span>delta_t_p <span class="op">=</span> strtod<span class="op">(</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>      <span class="op">*</span>output_freq_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">4</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>      <span class="op">*</span>g_i_p <span class="op">=</span> argv<span class="op">[</span><span class="dv">5</span><span class="op">][</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>n_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_INT<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>n_steps_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_INT<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>delta_t_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_DOUBLE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-23" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb234"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>output_freq_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_INT<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>g_i_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_CHAR<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>n_p <span class="op">&lt;=</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>n_steps_p <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>delta_t_p <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>      MPI_Finalize<span class="op">();</span></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>      exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-24" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb235"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;g&#39;</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>      MPI_Finalize<span class="op">();</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>      exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-25" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb236"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;n = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_p<span class="op">);</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;n_steps = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_steps_p<span class="op">);</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;delta_t = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>delta_t_p<span class="op">);</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;output_freq = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>output_freq_p<span class="op">);</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;g_i = %c</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>g_i_p<span class="op">);</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-26" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb237"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_args */</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:   Get_init_cond</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:    Read in initial conditions:  mass, position and velocity</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-27" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb238"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>             <span class="cf">for</span> each particle</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       total number of particles</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>   number of particles assigned to this process</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>  global array of the masses of the particles</span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pos<span class="op">:</span>     global array of positions</span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-28" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb239"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_vel<span class="op">:</span> local array of velocities assigned to this process<span class="op">.</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Global var<span class="op">:</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    vel<span class="op">:</span>     Scratch<span class="op">.</span>  Used by process <span class="dv">0</span> <span class="cf">for</span> global velocities</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t pos<span class="op">[],</span></span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>     vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-29" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb240"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;For each particle, enter (in order):</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;   its mass, its x-coord, its y-coord, &quot;</span><span class="op">);</span></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;its x-velocity, its y-velocity</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-30" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb241"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>masses<span class="op">[</span>part<span class="op">]);</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>pos<span class="op">[</span>part<span class="op">][</span>X<span class="op">]);</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>pos<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>vel<span class="op">[</span>part<span class="op">][</span>X<span class="op">]);</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>vel<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-31" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb242"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>masses<span class="op">,</span> n<span class="op">,</span> MPI_DOUBLE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>pos<span class="op">,</span> n<span class="op">,</span> vect_mpi_t<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>   MPI_Scatter<span class="op">(</span>vel<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>         loc_vel<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_init_cond */</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-32" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb243"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Function<span class="op">:</span>  Gen_init_cond</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Generate initial conditions<span class="op">:</span>  mass<span class="op">,</span> position and velocity</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            <span class="cf">for</span> each particle</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       total number of particles</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>   number of particles assigned to this process</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-33" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb244"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>  global array of the masses of the particles</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pos<span class="op">:</span>     global array of positions</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_vel<span class="op">:</span> local array of velocities assigned to this process<span class="op">.</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Global var<span class="op">:</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    vel<span class="op">:</span>     Scratch<span class="op">.</span>  Used by process <span class="dv">0</span> <span class="cf">for</span> global velocities</span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>      The initial conditions place all particles at</span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-34" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb245"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            equal intervals on the nonnegative x<span class="op">-</span>axis with</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            identical masses<span class="op">,</span> and identical initial speeds</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            parallel to the y<span class="op">-</span>axis<span class="op">.</span>  However<span class="op">,</span> some of the</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            velocities are in the positive y<span class="op">-</span>direction and</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            some are negative<span class="op">.</span></span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t pos<span class="op">[],</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-35" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb246"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mass <span class="op">=</span> <span class="fl">5.0e24</span><span class="op">;</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> gap <span class="op">=</span> <span class="fl">1.0e5</span><span class="op">;</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> speed <span class="op">=</span> <span class="fl">3.0e4</span><span class="op">;</span></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-36" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb247"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co">//    srandom(1);</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>         masses<span class="op">[</span>part<span class="op">]</span> <span class="op">=</span> mass<span class="op">;</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>         pos<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">=</span> part<span class="op">*</span>gap<span class="op">;</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>         pos<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>         vel<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a><span class="co">//       if (random()/((double) RAND_MAX) &gt;= 0.5)</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-37" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb248"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>part <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>            vel<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> speed<span class="op">;</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>            vel<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> <span class="op">-</span>speed<span class="op">;</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-38" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb249"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>masses<span class="op">,</span> n<span class="op">,</span> MPI_DOUBLE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>pos<span class="op">,</span> n<span class="op">,</span> vect_mpi_t<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>   MPI_Scatter<span class="op">(</span>vel<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>         loc_vel<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Gen_init_cond */</span></span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-39" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb250"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:   Output_state</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:    Print the current state of the system</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a><span class="co"> *    time:    current time</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    masses:  global array of particle masses</span></span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    pos:     global array of particle positions</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-40" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb251"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_vel<span class="op">:</span> local array of my particle velocities</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       total number of particles</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>   number of my particles</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t pos<span class="op">[],</span></span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-41" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb252"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>   MPI_Gather<span class="op">(</span>loc_vel<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> vel<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>         <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;%.2f</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> time<span class="op">);</span></span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a><span class="co">//       printf(&quot;%.3f &quot;, masses[part]);</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-42" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb253"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;%3d %10.3e &quot;</span><span class="op">,</span> part<span class="op">,</span> pos<span class="op">[</span>part<span class="op">][</span>X<span class="op">]);</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> pos<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> vel<span class="op">[</span>part<span class="op">][</span>X<span class="op">]);</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;  %10.3e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> vel<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-43" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb254"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Output_state */</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:       Compute_force</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:        Compute the total force on particle loc_part.  Don&#39;t</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *                 exploit the symmetry (force on particle i due to</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-44" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb255"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                 particle k<span class="op">)</span> <span class="op">=</span> <span class="op">-(</span>force on particle k due to particle i<span class="op">)</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_part<span class="op">:</span>    the particle <span class="op">(</span>local index<span class="op">)</span> on which we&#39;re computing</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                 the total force</span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>      global array of particle masses</span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pos<span class="op">:</span>         global array of particle positions</span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>           total number of particles</span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-45" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb256"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>       number of my particles</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out arg<span class="op">:</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_forces<span class="op">:</span>  array of total forces acting on my particles</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span> This function uses the force due to gravitation<span class="op">.</span>  So</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> the force on particle i due to particle k is given by</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-46" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb257"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    m_i m_k <span class="op">(</span>s_k <span class="op">-</span> s_i<span class="op">)/|</span>s_k <span class="op">-</span> s_i<span class="op">|^</span><span class="dv">2</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Here<span class="op">,</span> m_k is the mass of particle k and s_k is its position vector</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> <span class="op">(</span>at time t<span class="op">).</span></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force<span class="op">(</span><span class="dt">int</span> loc_part<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_forces<span class="op">[],</span></span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>      vect_t pos<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-47" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb258"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> k<span class="op">,</span> part<span class="op">;</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mg<span class="op">;</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>   vect_t f_part_k<span class="op">;</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> len<span class="op">,</span> len_3<span class="op">,</span> fact<span class="op">;</span></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* Global index corresponding to loc_part */</span></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>   part <span class="op">=</span> my_rank<span class="op">*</span>loc_n <span class="op">+</span> loc_part<span class="op">;</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-48" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb259"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>   loc_forces<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">]</span> <span class="op">=</span> loc_forces<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Current total force on part %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>         my_rank<span class="op">,</span> part<span class="op">,</span> loc_forces<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>         loc_forces<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> n<span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-49" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb260"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>k <span class="op">!=</span> part<span class="op">)</span> <span class="op">{</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>         <span class="co">/* Compute force on part due to k */</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> pos<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">-</span> pos<span class="op">[</span>k<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> pos<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">-</span> pos<span class="op">[</span>k<span class="op">][</span>Y<span class="op">];</span></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>         len <span class="op">=</span> sqrt<span class="op">(</span>f_part_k<span class="op">[</span>X<span class="op">]*</span>f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> f_part_k<span class="op">[</span>Y<span class="op">]*</span>f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>         len_3 <span class="op">=</span> len<span class="op">*</span>len<span class="op">*</span>len<span class="op">;</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>         mg <span class="op">=</span> <span class="op">-</span>G<span class="op">*</span>masses<span class="op">[</span>part<span class="op">]*</span>masses<span class="op">[</span>k<span class="op">];</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-50" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb261"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>         fact <span class="op">=</span> mg<span class="op">/</span>len_3<span class="op">;</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>         f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#        ifdef DEBUG</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Force on part %d due to part %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>               my_rank<span class="op">,</span> part<span class="op">,</span> k<span class="op">,</span> f_part_k<span class="op">[</span>X<span class="op">],</span> f_part_k<span class="op">[</span>Y<span class="op">]);</span></span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#        endif</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-51" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb262"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>         <span class="co">/* Add force in to total forces */</span></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>         loc_forces<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>         loc_forces<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_force */</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-52" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb263"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Update_part</span></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Update the velocity and position for particle loc_part</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    loc_part:    local index of the particle we&#39;re updating</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-53" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb264"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>      global array of particle masses</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_forces<span class="op">:</span>  local array of total forces</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>           total number of particles</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>       number of particles assigned to this process</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    delta_t<span class="op">:</span>     step size</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In<span class="op">/</span>out args<span class="op">:</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-54" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb265"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_pos<span class="op">:</span>     local array of positions</span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_vel<span class="op">:</span>     local array of velocities</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>  This version uses Euler&#39;s method to update both the velocity</span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    and the position<span class="op">.</span></span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> loc_part<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_forces<span class="op">[],</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-55" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb266"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>      vect_t loc_pos<span class="op">[],</span> vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">,</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span> delta_t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> fact<span class="op">;</span></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>   part <span class="op">=</span> my_rank<span class="op">*</span>loc_n <span class="op">+</span> loc_part<span class="op">;</span></span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>   fact <span class="op">=</span> delta_t<span class="op">/</span>masses<span class="op">[</span>part<span class="op">];</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-56" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb267"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Before update of %d:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> my_rank<span class="op">,</span> part<span class="op">);</span></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Position  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>         loc_pos<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_pos<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Velocity  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a>         loc_vel<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_vel<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Net force = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-57" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb268"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>         loc_forces<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_forces<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>   loc_pos<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> loc_vel<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>   loc_pos<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> loc_vel<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">];</span></span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>   loc_vel<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> loc_forces<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>   loc_vel<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> loc_forces<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">];</span></span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span></code></pre></div>
</section>
<section id="mpi-osnovna-forma-58" class="slide level2">
<h2>MPI Osnovna forma</h2>
<div class="sourceCode" id="cb269"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Position of %d = (%.3e, %.3e), Velocity = (%.3e,%.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>         my_rank<span class="op">,</span> part<span class="op">,</span> loc_pos<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_pos<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">],</span></span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a>               loc_vel<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_vel<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Update_part */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb270"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;mpi.h&gt;</span></span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DIM 2  </span><span class="co">/* Two-dimensional system */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-1" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb271"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define X 0    </span><span class="co">/* x-coordinate subscript */</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define Y 1    </span><span class="co">/* y-coordinate subscript */</span></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">double</span> vect_t<span class="op">[</span>DIM<span class="op">];</span>  <span class="co">/* Vector type for position, etc. */</span></span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* Global variables.  Except for vel all are unchanged after being set */</span></span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">double</span> G <span class="op">=</span> <span class="fl">6.673e-11</span><span class="op">;</span>  <span class="co">/* Gravitational constant. */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-2" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb272"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>                             <span class="co">/* Units are m^3/(kg*s^2)  */</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> my_rank<span class="op">,</span> comm_sz<span class="op">;</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>MPI_Comm comm<span class="op">;</span></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>MPI_Datatype vect_mpi_t<span class="op">;</span></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>MPI_Datatype cyclic_mpi_t<span class="op">;</span></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a><span class="co">/* Scratch arrays used by process 0 for I/O */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-3" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb273"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>vect_t <span class="op">*</span>vel <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>vect_t <span class="op">*</span>pos <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">);</span></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span></span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">);</span></span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Build_cyclic_mpi_type<span class="op">(</span><span class="dt">int</span> loc_n<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-4" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb274"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_pos<span class="op">[],</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">);</span></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_pos<span class="op">[],</span></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">);</span></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_pos<span class="op">[],</span></span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">);</span></span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_forces<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t tmp_data<span class="op">[],</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-5" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb275"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>      vect_t loc_forces<span class="op">[],</span> vect_t loc_pos<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">);</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_proc_forces<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t tmp_data<span class="op">[],</span></span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>      vect_t loc_forces<span class="op">[],</span> vect_t pos1<span class="op">[],</span> <span class="dt">int</span> loc_n1<span class="op">,</span> <span class="dt">int</span> rk1<span class="op">,</span></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> loc_n2<span class="op">,</span> <span class="dt">int</span> rk2<span class="op">,</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> p<span class="op">);</span></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> Local_to_global<span class="op">(</span><span class="dt">int</span> loc_part<span class="op">,</span> <span class="dt">int</span> proc_rk<span class="op">,</span> <span class="dt">int</span> proc_count<span class="op">);</span></span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> Global_to_local<span class="op">(</span><span class="dt">int</span> gbl_part<span class="op">,</span> <span class="dt">int</span> proc_rk<span class="op">,</span> <span class="dt">int</span> proc_count<span class="op">);</span></span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> First_index<span class="op">(</span><span class="dt">int</span> gbl1<span class="op">,</span> <span class="dt">int</span> proc_rk1<span class="op">,</span> <span class="dt">int</span> proc_rk2<span class="op">,</span> <span class="dt">int</span> proc_count<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-6" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb276"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force_pair<span class="op">(</span><span class="dt">double</span> m1<span class="op">,</span> <span class="dt">double</span> m2<span class="op">,</span> vect_t pos1<span class="op">,</span> vect_t pos2<span class="op">,</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>      vect_t force1<span class="op">,</span> vect_t force2<span class="op">);</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> loc_part<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_forces<span class="op">[],</span></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>      vect_t loc_pos<span class="op">[],</span> vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">,</span> <span class="dt">double</span> delta_t<span class="op">);</span></span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*--------------------------------------------------------------------*/</span></span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-7" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb277"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n<span class="op">;</span>                      <span class="co">/* Total number of particles     */</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> loc_n<span class="op">;</span>                  <span class="co">/* Number of my particles        */</span></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> n_steps<span class="op">;</span>                <span class="co">/* Number of timesteps           */</span></span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> step<span class="op">;</span>                   <span class="co">/* Current step                  */</span></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> output_freq<span class="op">;</span>            <span class="co">/* Frequency of output           */</span></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> delta_t<span class="op">;</span>             <span class="co">/* Size of timestep              */</span></span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> t<span class="op">;</span>                   <span class="co">/* Current Time                  */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-8" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb278"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span><span class="op">*</span> masses<span class="op">;</span>             <span class="co">/* All the masses                */</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> loc_pos<span class="op">;</span>            <span class="co">/* Positions of my particles     */</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> tmp_data<span class="op">;</span>           <span class="co">/* Received positions and forces */</span></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> loc_vel<span class="op">;</span>            <span class="co">/* Velocities of my particles    */</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>   vect_t<span class="op">*</span> loc_forces<span class="op">;</span>         <span class="co">/* Forces on my particles        */</span></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> loc_part<span class="op">;</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-9" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb279"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">char</span> g_i<span class="op">;</span>                   <span class="co">/*_G_en or _i_nput init conds */</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> start<span class="op">,</span> finish<span class="op">;</span>       <span class="co">/* For timings                */</span></span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>   MPI_Init<span class="op">(&amp;</span>argc<span class="op">,</span> <span class="op">&amp;</span>argv<span class="op">);</span></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>   comm <span class="op">=</span> MPI_COMM_WORLD<span class="op">;</span></span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>   MPI_Comm_size<span class="op">(</span>comm<span class="op">,</span> <span class="op">&amp;</span>comm_sz<span class="op">);</span></span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>   MPI_Comm_rank<span class="op">(</span>comm<span class="op">,</span> <span class="op">&amp;</span>my_rank<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-10" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb280"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>   Get_args<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>n_steps<span class="op">,</span> <span class="op">&amp;</span>delta_t<span class="op">,</span> <span class="op">&amp;</span>output_freq<span class="op">,</span> <span class="op">&amp;</span>g_i<span class="op">);</span></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>   loc_n <span class="op">=</span> n<span class="op">/</span>comm_sz<span class="op">;</span>  <span class="co">/* n should be evenly divisible by comm_sz */</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>   masses <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>   tmp_data <span class="op">=</span> malloc<span class="op">(</span><span class="dv">2</span><span class="op">*</span>loc_n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>   loc_forces <span class="op">=</span> malloc<span class="op">(</span>loc_n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>   loc_pos <span class="op">=</span> malloc<span class="op">(</span>loc_n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-11" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb281"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>   loc_vel <span class="op">=</span> malloc<span class="op">(</span>loc_n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>      pos <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>      vel <span class="op">=</span> malloc<span class="op">(</span>n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>   MPI_Type_contiguous<span class="op">(</span>DIM<span class="op">,</span> MPI_DOUBLE<span class="op">,</span> <span class="op">&amp;</span>vect_mpi_t<span class="op">);</span></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a>   MPI_Type_commit<span class="op">(&amp;</span>vect_mpi_t<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-12" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb282"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>   Build_cyclic_mpi_type<span class="op">(</span>loc_n<span class="op">);</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>g_i <span class="op">==</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span></span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>      Get_init_cond<span class="op">(</span>masses<span class="op">,</span> loc_pos<span class="op">,</span> loc_vel<span class="op">,</span> n<span class="op">,</span> loc_n<span class="op">);</span></span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>      Gen_init_cond<span class="op">(</span>masses<span class="op">,</span> loc_pos<span class="op">,</span> loc_vel<span class="op">,</span> n<span class="op">,</span> loc_n<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-13" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb283"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>   start <span class="op">=</span> MPI_Wtime<span class="op">();</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifndef NO_OUTPUT</span></span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>   Output_state<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> masses<span class="op">,</span> loc_pos<span class="op">,</span> loc_vel<span class="op">,</span> n<span class="op">,</span> loc_n<span class="op">);</span></span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>step <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> step <span class="op">&lt;=</span> n_steps<span class="op">;</span> step<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>      t <span class="op">=</span> step<span class="op">*</span>delta_t<span class="op">;</span></span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>      Compute_forces<span class="op">(</span>masses<span class="op">,</span> tmp_data<span class="op">,</span> loc_forces<span class="op">,</span> loc_pos<span class="op">,</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-14" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb284"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>            n<span class="op">,</span> loc_n<span class="op">);</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>loc_part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> loc_part <span class="op">&lt;</span> loc_n<span class="op">;</span> loc_part<span class="op">++)</span></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>         Update_part<span class="op">(</span>loc_part<span class="op">,</span> masses<span class="op">,</span> loc_forces<span class="op">,</span> loc_pos<span class="op">,</span> loc_vel<span class="op">,</span></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>               n<span class="op">,</span> loc_n<span class="op">,</span> delta_t<span class="op">);</span></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#     ifndef NO_OUTPUT</span></span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>step <span class="op">%</span> output_freq <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a>         Output_state<span class="op">(</span>t<span class="op">,</span> masses<span class="op">,</span> loc_pos<span class="op">,</span> loc_vel<span class="op">,</span> n<span class="op">,</span> loc_n<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-15" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb285"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#     endif</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>   finish <span class="op">=</span> MPI_Wtime<span class="op">();</span></span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;Elapsed time = %e seconds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> finish<span class="op">-</span>start<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-16" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb286"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>   MPI_Type_free<span class="op">(&amp;</span>vect_mpi_t<span class="op">);</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>   MPI_Type_free<span class="op">(&amp;</span>cyclic_mpi_t<span class="op">);</span></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>masses<span class="op">);</span></span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>tmp_data<span class="op">);</span></span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>loc_forces<span class="op">);</span></span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>loc_pos<span class="op">);</span></span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a>   free<span class="op">(</span>loc_vel<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-17" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb287"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>      free<span class="op">(</span>pos<span class="op">);</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>      free<span class="op">(</span>vel<span class="op">);</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a>   MPI_Finalize<span class="op">();</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-18" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb288"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* main */</span></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function: Usage</span></span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:  Print instructions for command-line and exit</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-19" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb289"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In arg<span class="op">:</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    prog_name<span class="op">:</span>  the name of the program as typed on the command<span class="op">-</span>line</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Usage<span class="op">(</span><span class="dt">char</span><span class="op">*</span> prog_name<span class="op">)</span> <span class="op">{</span></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;usage: mpiexec -n &lt;number of processes&gt; %s</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> prog_name<span class="op">);</span></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;number of particles&gt; &lt;number of timesteps&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-20" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb290"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;size of timestep&gt; &lt;output frequency&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &lt;g|i&gt;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;g&#39;: program should generate init conds</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>   fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;   &#39;i&#39;: program should get init conds from stdin</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Usage */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-21" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb291"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Get_args</span></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Get command line args</span></span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *    argc:            number of command line args</span></span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    argv:            command line args</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-22" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb292"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_p<span class="op">:</span>             pointer to n<span class="op">,</span> the number of particles</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n_steps_p<span class="op">:</span>       pointer to n_steps<span class="op">,</span> the number of timesteps</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    delta_t_p<span class="op">:</span>       pointer to delta_t<span class="op">,</span> the size of each timestep</span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    output_freq_p<span class="op">:</span>   pointer to output_freq<span class="op">,</span> which is the number of</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     timesteps between steps whose output is printed</span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    g_i_p<span class="op">:</span>           pointer to <span class="dt">char</span> which is <span class="ch">&#39;g&#39;</span> <span class="cf">if</span> the init conds</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-23" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb293"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     should be generated by the program and <span class="ch">&#39;i&#39;</span> <span class="cf">if</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     they should be read from stdin</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_args<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[],</span> <span class="dt">int</span><span class="op">*</span> n_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> n_steps_p<span class="op">,</span></span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span><span class="op">*</span> delta_t_p<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> output_freq_p<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> g_i_p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">6</span><span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-24" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb294"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>         Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>n_p <span class="op">=</span> <span class="op">*</span>n_steps_p <span class="op">=</span> <span class="op">*</span>output_freq_p <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>delta_t_p <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>g_i_p <span class="op">=</span> <span class="ch">&#39;g&#39;</span><span class="op">;</span></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>n_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>n_steps_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-25" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb295"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>delta_t_p <span class="op">=</span> strtod<span class="op">(</span>argv<span class="op">[</span><span class="dv">3</span><span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>output_freq_p <span class="op">=</span> strtol<span class="op">(</span>argv<span class="op">[</span><span class="dv">4</span><span class="op">],</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>         <span class="op">*</span>g_i_p <span class="op">=</span> argv<span class="op">[</span><span class="dv">5</span><span class="op">][</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>n_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_INT<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>n_steps_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_INT<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-26" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb296"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>delta_t_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_DOUBLE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>output_freq_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_INT<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>g_i_p<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> MPI_CHAR<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>n_p <span class="op">&lt;=</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>n_steps_p <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> <span class="op">*</span>delta_t_p <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> argc <span class="op">&gt;</span> <span class="dv">6</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>      MPI_Finalize<span class="op">();</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-27" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb297"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>      exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;g&#39;</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>g_i_p <span class="op">!=</span> <span class="ch">&#39;i&#39;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> Usage<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>      MPI_Finalize<span class="op">();</span></span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>      exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-28" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb298"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;n = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_p<span class="op">);</span></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;n_steps = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>n_steps_p<span class="op">);</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;delta_t = %e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>delta_t_p<span class="op">);</span></span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;output_freq = %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>output_freq_p<span class="op">);</span></span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;g_i = %c</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>g_i_p<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-29" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb299"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_args */</span></span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:         Build_cyclic_mpi_type</span></span>
<span id="cb299-7"><a href="#cb299-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:          Build an MPI derived datatype that can be used with</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-30" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb300"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                   cyclically distributed data<span class="op">.</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In arg<span class="op">:</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>         The number of elements assigned to each process</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Global out<span class="op">:</span></span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    cyclic_mpi_t<span class="op">:</span>  An MPI datatype that can be used with cyclically</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                   distributed data</span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-31" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb301"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Build_cyclic_mpi_type<span class="op">(</span><span class="dt">int</span> loc_n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>   MPI_Datatype temp_mpi_t<span class="op">;</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>   MPI_Aint lb<span class="op">,</span> extent<span class="op">;</span></span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>   MPI_Type_vector<span class="op">(</span>loc_n<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> comm_sz<span class="op">,</span> vect_mpi_t<span class="op">,</span> <span class="op">&amp;</span>temp_mpi_t<span class="op">);</span></span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>   MPI_Type_get_extent<span class="op">(</span>vect_mpi_t<span class="op">,</span> <span class="op">&amp;</span>lb<span class="op">,</span> <span class="op">&amp;</span>extent<span class="op">);</span></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a>   MPI_Type_create_resized<span class="op">(</span>temp_mpi_t<span class="op">,</span> lb<span class="op">,</span> extent<span class="op">,</span> <span class="op">&amp;</span>cyclic_mpi_t<span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-32" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb302"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>   MPI_Type_commit<span class="op">(&amp;</span>cyclic_mpi_t<span class="op">);</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Build_cyclic_mpi_type */</span></span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:   Get_init_cond</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-33" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb303"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>    Read in initial conditions<span class="op">:</span>  mass<span class="op">,</span> position and velocity</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>             <span class="cf">for</span> each particle</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       total number of particles</span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>   number of particles assigned to this process</span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb303-7"><a href="#cb303-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>  global array of the masses of the particles</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-34" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb304"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_pos<span class="op">:</span> local array of the positions of the particles assigned</span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>             to this process</span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_vel<span class="op">:</span> local array of velocities assigned to this process<span class="op">.</span></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Global var<span class="op">:</span></span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pos<span class="op">:</span>     Scratch<span class="op">.</span>  Used by process <span class="dv">0</span> <span class="cf">for</span> global positions</span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    vel<span class="op">:</span>     Scratch<span class="op">.</span>  Used by process <span class="dv">0</span> <span class="cf">for</span> global velocities</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-35" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb305"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Get_init_cond<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_pos<span class="op">[],</span></span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>     vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;For each particle, enter (in order):</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-36" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb306"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;   its mass, its x-coord, its y-coord, &quot;</span><span class="op">);</span></span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;its x-velocity, its y-velocity</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>masses<span class="op">[</span>part<span class="op">]);</span></span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>pos<span class="op">[</span>part<span class="op">][</span>X<span class="op">]);</span></span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>pos<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>vel<span class="op">[</span>part<span class="op">][</span>X<span class="op">]);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-37" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb307"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>         scanf<span class="op">(</span><span class="st">&quot;%lf&quot;</span><span class="op">,</span> <span class="op">&amp;</span>vel<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>masses<span class="op">,</span> n<span class="op">,</span> MPI_DOUBLE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>   MPI_Scatter<span class="op">(</span>pos<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> cyclic_mpi_t<span class="op">,</span></span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>         loc_pos<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb307-7"><a href="#cb307-7" aria-hidden="true" tabindex="-1"></a>   MPI_Scatter<span class="op">(</span>vel<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> cyclic_mpi_t<span class="op">,</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-38" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb308"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>         loc_vel<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Get_init_cond */</span></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:  Gen_init_cond</span></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:   Generate initial conditions:  mass, position and velocity</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-39" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb309"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            <span class="cf">for</span> each particle</span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       total number of particles</span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>   number of particles assigned to this process</span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out args<span class="op">:</span></span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>  global array of the masses of the particles</span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pos<span class="op">:</span>     global array of positions</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-40" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb310"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_pos<span class="op">:</span> local array of the positions of the particles assigned</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>             to this process</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_vel<span class="op">:</span> local array of velocities assigned to this process<span class="op">.</span></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Global vars<span class="op">:</span></span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pos<span class="op">:</span>     Scratch<span class="op">.</span>  Used by process <span class="dv">0</span> <span class="cf">for</span> global positions</span>
<span id="cb310-6"><a href="#cb310-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    vel<span class="op">:</span>     Scratch<span class="op">.</span>  Used by process <span class="dv">0</span> <span class="cf">for</span> global velocities</span>
<span id="cb310-7"><a href="#cb310-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-41" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb311"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>      The initial conditions place all particles at</span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            equal intervals on the nonnegative x<span class="op">-</span>axis with</span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            identical masses<span class="op">,</span> and identical initial speeds</span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            parallel to the y<span class="op">-</span>axis<span class="op">.</span>  However<span class="op">,</span> some of the</span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            velocities are in the positive y<span class="op">-</span>direction and</span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>            some are negative<span class="op">.</span></span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-42" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb312"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Gen_init_cond<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_pos<span class="op">[],</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mass <span class="op">=</span> <span class="fl">5.0e24</span><span class="op">;</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> gap <span class="op">=</span> <span class="fl">1.0e5</span><span class="op">;</span></span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> speed <span class="op">=</span> <span class="fl">3.0e4</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-43" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb313"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="co">//    srandom(1);</span></span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a>         masses<span class="op">[</span>part<span class="op">]</span> <span class="op">=</span> mass<span class="op">;</span></span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a>         pos<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">=</span> part<span class="op">*</span>gap<span class="op">;</span></span>
<span id="cb313-6"><a href="#cb313-6" aria-hidden="true" tabindex="-1"></a>         pos<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb313-7"><a href="#cb313-7" aria-hidden="true" tabindex="-1"></a>         vel<span class="op">[</span>part<span class="op">][</span>X<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-44" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb314"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co">//       if (random()/((double) RAND_MAX) &gt;= 0.5)</span></span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>part <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a>            vel<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> speed<span class="op">;</span></span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span></span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a>            vel<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]</span> <span class="op">=</span> <span class="op">-</span>speed<span class="op">;</span></span>
<span id="cb314-6"><a href="#cb314-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb314-7"><a href="#cb314-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-45" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb315"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>   MPI_Bcast<span class="op">(</span>masses<span class="op">,</span> n<span class="op">,</span> MPI_DOUBLE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>   MPI_Scatter<span class="op">(</span>pos<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> cyclic_mpi_t<span class="op">,</span></span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a>         loc_pos<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a>   MPI_Scatter<span class="op">(</span>vel<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> cyclic_mpi_t<span class="op">,</span></span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a>         loc_vel<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb315-7"><a href="#cb315-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Gen_init_cond */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-46" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb316"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:   Output_state</span></span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:    Print the current state of the system</span></span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    time:    current time</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-47" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb317"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>  global array of particle masses</span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_pos<span class="op">:</span> local array of particle positions</span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_vel<span class="op">:</span> local array of my particle velocities</span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>       total number of particles</span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>   number of my particles</span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Global vars<span class="op">:</span></span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pos<span class="op">:</span>     Scratch<span class="op">.</span>  Used by proc <span class="dv">0</span> <span class="cf">for</span> global positions</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-48" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb318"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    vel<span class="op">:</span>     Scratch<span class="op">.</span>  Used by proc <span class="dv">0</span> <span class="cf">for</span> global velocities</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Output_state<span class="op">(</span><span class="dt">double</span> time<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_pos<span class="op">[],</span></span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>      vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-7"><a href="#cb318-7" aria-hidden="true" tabindex="-1"></a>   MPI_Gather<span class="op">(</span>loc_pos<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> pos<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> cyclic_mpi_t<span class="op">,</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-49" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb319"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>         <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>   MPI_Gather<span class="op">(</span>loc_vel<span class="op">,</span> loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> vel<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> cyclic_mpi_t<span class="op">,</span></span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>         <span class="dv">0</span><span class="op">,</span> comm<span class="op">);</span></span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>my_rank <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;%.2f</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> time<span class="op">);</span></span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> part <span class="op">&lt;</span> n<span class="op">;</span> part<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb319-7"><a href="#cb319-7" aria-hidden="true" tabindex="-1"></a><span class="co">//       printf(&quot;%.3f &quot;, masses[part]);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-50" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb320"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;%3d %10.3e &quot;</span><span class="op">,</span> part<span class="op">,</span> pos<span class="op">[</span>part<span class="op">][</span>X<span class="op">]);</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> pos<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;  %10.3e &quot;</span><span class="op">,</span> vel<span class="op">[</span>part<span class="op">][</span>X<span class="op">]);</span></span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;  %10.3e</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> vel<span class="op">[</span>part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-51" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb321"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Output_state */</span></span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:       Compute_forces</span></span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:        Compute the total force on each local particle.</span></span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *                 Exploit the symmetry (force on particle i due to</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-52" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb322"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                 particle k<span class="op">)</span> <span class="op">=</span> <span class="op">-(</span>force on particle k due to particle i<span class="op">)</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>      global array of particle masses <span class="op">(</span>dimension n<span class="op">)</span></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_pos<span class="op">:</span>     local array of positions of my particles <span class="op">(</span>dim loc_n<span class="op">)</span></span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>           total number of particles</span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>       number of my particles</span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Scratch<span class="op">:</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-53" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb323"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    tmp_data<span class="op">:</span>    Stores received positions <span class="op">(</span>subscripts <span class="dv">0</span> <span class="op">-</span> loc_n<span class="op">-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                 and forces computed thus far on particles corresp</span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                 onding to received positions <span class="op">(</span>subscripts</span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                 loc_n <span class="op">-</span> <span class="dv">2</span><span class="op">*</span>loc_n<span class="op">-</span><span class="dv">1</span><span class="op">).</span>  <span class="op">(</span>dimension <span class="dv">2</span><span class="op">*</span>loc_n<span class="op">)</span></span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Out arg<span class="op">:</span></span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_forces<span class="op">:</span>  array of total forces acting on my particles</span>
<span id="cb323-7"><a href="#cb323-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-54" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb324"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_forces<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t tmp_data<span class="op">[],</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>      vect_t loc_forces<span class="op">[],</span> vect_t loc_pos<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> src<span class="op">,</span> dest<span class="op">;</span>  <span class="co">/* Source and dest processes for particle pos */</span></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> i<span class="op">,</span> other_proc<span class="op">,</span> loc_part<span class="op">;</span></span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a>   MPI_Status status<span class="op">;</span></span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-7"><a href="#cb324-7" aria-hidden="true" tabindex="-1"></a>   src <span class="op">=</span> <span class="op">(</span>my_rank <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> comm_sz<span class="op">;</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-55" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb325"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>   dest <span class="op">=</span> <span class="op">(</span>my_rank <span class="op">-</span> <span class="dv">1</span> <span class="op">+</span> comm_sz<span class="op">)</span> <span class="op">%</span> comm_sz<span class="op">;</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>   memcpy<span class="op">(</span>tmp_data<span class="op">,</span> loc_pos<span class="op">,</span> loc_n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>   memset<span class="op">(</span>tmp_data <span class="op">+</span> loc_n<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> loc_n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>   memset<span class="op">(</span>loc_forces<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> loc_n<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>vect_t<span class="op">));</span></span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-6"><a href="#cb325-6" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* First compute the forces resulting from my particles&#39; interactions</span></span>
<span id="cb325-7"><a href="#cb325-7" aria-hidden="true" tabindex="-1"></a><span class="co">    * with themselves */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-56" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb326"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>   Compute_proc_forces<span class="op">(</span>masses<span class="op">,</span> tmp_data<span class="op">,</span> loc_forces<span class="op">,</span> loc_pos<span class="op">,</span> loc_n<span class="op">,</span></span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>         my_rank<span class="op">,</span> loc_n<span class="op">,</span> my_rank<span class="op">,</span> n<span class="op">,</span> comm_sz<span class="op">);</span></span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* Now compute forces resulting from my particles&#39; interactions with</span></span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a><span class="co">    * other processes&#39; particles */</span></span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> comm_sz<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a>      other_proc <span class="op">=</span> <span class="op">(</span>my_rank <span class="op">+</span> i<span class="op">)</span> <span class="op">%</span> comm_sz<span class="op">;</span></span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a>      MPI_Sendrecv_replace<span class="op">(</span>tmp_data<span class="op">,</span> <span class="dv">2</span><span class="op">*</span>loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> dest<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> src<span class="op">,</span> <span class="dv">0</span><span class="op">,</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-57" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb327"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>            comm<span class="op">,</span> <span class="op">&amp;</span>status<span class="op">);</span></span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>      Compute_proc_forces<span class="op">(</span>masses<span class="op">,</span> tmp_data<span class="op">,</span> loc_forces<span class="op">,</span> loc_pos<span class="op">,</span> loc_n<span class="op">,</span></span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>            my_rank<span class="op">,</span> loc_n<span class="op">,</span> other_proc<span class="op">,</span> n<span class="op">,</span> comm_sz<span class="op">);</span></span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb327-5"><a href="#cb327-5" aria-hidden="true" tabindex="-1"></a>   MPI_Sendrecv_replace<span class="op">(</span>tmp_data<span class="op">,</span> <span class="dv">2</span><span class="op">*</span>loc_n<span class="op">,</span> vect_mpi_t<span class="op">,</span> dest<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> src<span class="op">,</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb327-6"><a href="#cb327-6" aria-hidden="true" tabindex="-1"></a>         comm<span class="op">,</span> <span class="op">&amp;</span>status<span class="op">);</span></span>
<span id="cb327-7"><a href="#cb327-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>loc_part <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> loc_part <span class="op">&lt;</span> loc_n<span class="op">;</span> loc_part<span class="op">++)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-58" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb328"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>      loc_forces<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> tmp_data<span class="op">[</span>loc_n<span class="op">+</span>loc_part<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>      loc_forces<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> tmp_data<span class="op">[</span>loc_n<span class="op">+</span>loc_part<span class="op">][</span>Y<span class="op">];</span></span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_forces */</span></span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-59" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb329"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:       Compute_proc_forces</span></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:        Compute the forces on particles owned by process</span></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="co"> *                 rk1 due to interaction with particles owned by</span></span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a><span class="co"> *                 procss rk2.  Exploit the symmetry (force on particle</span></span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a><span class="co"> *                 i due to particle k) = -(force on particle k due</span></span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *                 to particle i)</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-60" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb330"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>      global array of particle masses <span class="op">(</span>dim n<span class="op">)</span></span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pos1<span class="op">:</span>        local array of particle positions <span class="op">(</span>dim loc_n1<span class="op">)</span></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n1<span class="op">:</span>      number of my particles in pos1</span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    rk1<span class="op">:</span>         process owning particles in pos1</span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n2<span class="op">:</span>      number of particles contributed by second process</span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    rk2<span class="op">:</span>         process owning contributed particles</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-61" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb331"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>           total number of particles</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    p<span class="op">:</span>           number of processes in communicator containing</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                 processes rk1 and rk2</span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In<span class="op">/</span>out args<span class="op">:</span></span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    tmp_data<span class="op">:</span>    positions of rk2 particles <span class="op">(</span>in only<span class="op">,</span> loc_n2 positions<span class="op">)</span></span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                 followed by forces computed thus far corresp to</span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                    rk2 particles <span class="op">(</span>in and out<span class="op">,</span> loc_n2 positions<span class="op">)</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-62" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb332"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_forces<span class="op">:</span>  forces computed thus far on my particles <span class="op">(</span>loc_n1<span class="op">)</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_proc_forces<span class="op">(</span><span class="dt">double</span> masses<span class="op">[],</span> vect_t tmp_data<span class="op">[],</span></span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>      vect_t loc_forces<span class="op">[],</span> vect_t pos1<span class="op">[],</span> <span class="dt">int</span> loc_n1<span class="op">,</span> <span class="dt">int</span> rk1<span class="op">,</span></span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">int</span> loc_n2<span class="op">,</span> <span class="dt">int</span> rk2<span class="op">,</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> loc_part1<span class="op">,</span> loc_part2<span class="op">;</span></span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> gbl_part1<span class="op">,</span> gbl_part2<span class="op">;</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-63" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb333"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="op">(</span>gbl_part1 <span class="op">=</span> rk1<span class="op">,</span> loc_part1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>        loc_part1 <span class="op">&lt;</span> loc_n1<span class="op">;</span></span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>        loc_part1<span class="op">++,</span> gbl_part1 <span class="op">+=</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span><span class="op">(</span>gbl_part2 <span class="op">=</span> First_index<span class="op">(</span>gbl_part1<span class="op">,</span> rk1<span class="op">,</span> rk2<span class="op">,</span> p<span class="op">),</span></span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a>          loc_part2 <span class="op">=</span> Global_to_local<span class="op">(</span>gbl_part2<span class="op">,</span> rk2<span class="op">,</span> p<span class="op">);</span></span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>          loc_part2 <span class="op">&lt;</span> loc_n2<span class="op">;</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-64" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb334"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>          loc_part2<span class="op">++,</span> gbl_part2 <span class="op">+=</span> p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#        ifdef DEBUG</span></span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Current total force on part %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a>               my_rank<span class="op">,</span> gbl_part1<span class="op">,</span> loc_forces<span class="op">[</span>loc_part1<span class="op">][</span>X<span class="op">],</span></span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a>               loc_forces<span class="op">[</span>loc_part1<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Current total force on part %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb334-7"><a href="#cb334-7" aria-hidden="true" tabindex="-1"></a>               my_rank<span class="op">,</span> gbl_part2<span class="op">,</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-65" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb335"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>               tmp_data<span class="op">[</span>loc_n2<span class="op">+</span>loc_part2<span class="op">][</span>X<span class="op">],</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>               tmp_data<span class="op">[</span>loc_n2<span class="op">+</span>loc_part2<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#        endif</span></span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>         Compute_force_pair<span class="op">(</span>masses<span class="op">[</span>gbl_part1<span class="op">],</span> masses<span class="op">[</span>gbl_part2<span class="op">],</span></span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a>               pos1<span class="op">[</span>loc_part1<span class="op">],</span> tmp_data<span class="op">[</span>loc_part2<span class="op">],</span></span>
<span id="cb335-6"><a href="#cb335-6" aria-hidden="true" tabindex="-1"></a>               loc_forces<span class="op">[</span>loc_part1<span class="op">],</span> tmp_data<span class="op">[</span>loc_n2<span class="op">+</span>loc_part2<span class="op">]);</span></span>
<span id="cb335-7"><a href="#cb335-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#        ifdef DEBUG</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-66" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb336"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Current total force on part %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>               my_rank<span class="op">,</span> gbl_part1<span class="op">,</span> loc_forces<span class="op">[</span>loc_part1<span class="op">][</span>X<span class="op">],</span></span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>               loc_forces<span class="op">[</span>loc_part1<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Current total force on part %d = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>               my_rank<span class="op">,</span> gbl_part2<span class="op">,</span></span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>               tmp_data<span class="op">[</span>loc_n2<span class="op">+</span>loc_part2<span class="op">][</span>X<span class="op">],</span></span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>               tmp_data<span class="op">[</span>loc_n2<span class="op">+</span>loc_part2<span class="op">][</span>Y<span class="op">]);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-67" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb337"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#        endif</span></span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span> <span class="co">/* for gbl_part2 */</span></span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span> <span class="co">/* for gbl_part1 */</span></span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_proc_forces */</span></span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:    Local_to_global</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-68" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb338"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>     Convert a local particle index to a global particle</span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>              index</span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_part<span class="op">:</span>  local particle index</span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    proc_rk<span class="op">:</span>   process rank</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>     number of particles assigned to the process</span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>         total number of particles</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-69" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb339"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    proc_count<span class="op">:</span>  number of processes in the communicator</span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Ret val<span class="op">:</span></span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    global particle index</span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb339-5"><a href="#cb339-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Notes<span class="op">:</span></span>
<span id="cb339-6"><a href="#cb339-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> <span class="fl">1.</span>  This version assumes a cyclic distribution of the particles</span>
<span id="cb339-7"><a href="#cb339-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> <span class="fl">2.</span>  It also assumes loc_n <span class="op">=</span> n<span class="op">/</span>proc_count<span class="op">,</span> and n is evenly divisible</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-70" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb340"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>     by proc_count</span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> Local_to_global<span class="op">(</span><span class="dt">int</span> loc_part<span class="op">,</span> <span class="dt">int</span> proc_rk<span class="op">,</span> <span class="dt">int</span> proc_count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb340-4"><a href="#cb340-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> loc_part<span class="op">*</span>proc_count <span class="op">+</span> proc_rk<span class="op">;</span></span>
<span id="cb340-5"><a href="#cb340-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/*  Local_to_global */</span></span>
<span id="cb340-6"><a href="#cb340-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb340-7"><a href="#cb340-7" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-71" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb341"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Function<span class="op">:</span>    Global_to_local</span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>     Convert a global particle index to a global permuted</span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>              index</span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    gbl_part<span class="op">:</span>    The global particle index</span>
<span id="cb341-6"><a href="#cb341-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    proc_rk<span class="op">:</span>     The rank of the owning process</span>
<span id="cb341-7"><a href="#cb341-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    proc_count<span class="op">:</span>  The number of processes</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-72" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb342"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Notes<span class="op">:</span></span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> <span class="fl">1.</span>  This version assumes a cyclic distribution of the particles</span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> <span class="fl">2.</span>  It also assumes loc_n <span class="op">=</span> n<span class="op">/</span>proc_count<span class="op">,</span> and n is evenly divisible</span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>     by proc_count</span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> Global_to_local<span class="op">(</span><span class="dt">int</span> gbl_part<span class="op">,</span> <span class="dt">int</span> proc_rk<span class="op">,</span> <span class="dt">int</span> proc_count<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-73" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb343"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="op">(</span>gbl_part <span class="op">-</span> proc_rk<span class="op">)/</span>proc_count<span class="op">;</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Global_to_local */</span></span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:           First_index</span></span>
<span id="cb343-7"><a href="#cb343-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:            Given a global index glb1 assigned to process</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-74" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb344"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     rk1<span class="op">,</span> find the next higher global index assigned</span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     to process rk2</span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    gbl1<span class="op">:</span>            global particle index of particle assigned to</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     process rk1</span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    rk1<span class="op">:</span>             rank of process owning gbl1</span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    rk2<span class="op">:</span>             rank of process owning particle with computed index</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-75" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb345"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    proc_count<span class="op">:</span>      number of processes</span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Return val<span class="op">:</span>         next higher global particle index of particle assigned</span>
<span id="cb345-3"><a href="#cb345-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     to process rk2</span>
<span id="cb345-4"><a href="#cb345-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>               If there is no particle assigned to rk2 with index</span>
<span id="cb345-5"><a href="#cb345-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     greater than rk1<span class="op">,</span> the function will <span class="cf">return</span> a value</span>
<span id="cb345-6"><a href="#cb345-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     larger than n<span class="op">,</span> the total number of particles<span class="op">.</span></span>
<span id="cb345-7"><a href="#cb345-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-76" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb346"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> First_index<span class="op">(</span><span class="dt">int</span> gbl1<span class="op">,</span> <span class="dt">int</span> rk1<span class="op">,</span> <span class="dt">int</span> rk2<span class="op">,</span> <span class="dt">int</span> proc_count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="op">(</span>rk1 <span class="op">&lt;</span> rk2<span class="op">)</span></span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> gbl1 <span class="op">+</span> <span class="op">(</span>rk2 <span class="op">-</span> rk1<span class="op">);</span></span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span></span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> gbl1 <span class="op">+</span> <span class="op">(</span>rk2 <span class="op">-</span> rk1<span class="op">)</span> <span class="op">+</span> proc_count<span class="op">;</span></span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* First_index */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-77" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb347"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * Function:           Compute_force_pair</span></span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Purpose:            Compute the force resulting from the interaction of</span></span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a><span class="co"> *                     of two particles.  Exploit the fact that f_kq = -f_qk</span></span>
<span id="cb347-6"><a href="#cb347-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * In args:</span></span>
<span id="cb347-7"><a href="#cb347-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *    m1, m2:          Masses of the two particles</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-78" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb348"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    pos1<span class="op">,</span> pos2<span class="op">:</span>      Positions of the two particles</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In<span class="op">/</span>out args<span class="op">:</span></span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    force1<span class="op">,</span> force2<span class="op">:</span>  The total forces on the two particles as thus far</span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>                     computed</span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Compute_force_pair<span class="op">(</span><span class="dt">double</span> m1<span class="op">,</span> <span class="dt">double</span> m2<span class="op">,</span> vect_t pos1<span class="op">,</span> vect_t pos2<span class="op">,</span></span>
<span id="cb348-7"><a href="#cb348-7" aria-hidden="true" tabindex="-1"></a>      vect_t force1<span class="op">,</span> vect_t force2<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-79" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb349"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> mg<span class="op">;</span></span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a>   vect_t f_part_k<span class="op">;</span></span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> len<span class="op">,</span> len_3<span class="op">,</span> fact<span class="op">;</span></span>
<span id="cb349-4"><a href="#cb349-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-5"><a href="#cb349-5" aria-hidden="true" tabindex="-1"></a>   f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">=</span> pos1<span class="op">[</span>X<span class="op">]</span> <span class="op">-</span> pos2<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb349-6"><a href="#cb349-6" aria-hidden="true" tabindex="-1"></a>   f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">=</span> pos1<span class="op">[</span>Y<span class="op">]</span> <span class="op">-</span> pos2<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb349-7"><a href="#cb349-7" aria-hidden="true" tabindex="-1"></a>   len <span class="op">=</span> sqrt<span class="op">(</span>f_part_k<span class="op">[</span>X<span class="op">]*</span>f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">+</span> f_part_k<span class="op">[</span>Y<span class="op">]*</span>f_part_k<span class="op">[</span>Y<span class="op">]);</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-80" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb350"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a>   len_3 <span class="op">=</span> len<span class="op">*</span>len<span class="op">*</span>len<span class="op">;</span></span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>   mg <span class="op">=</span> <span class="op">-</span>G<span class="op">*</span>m1<span class="op">*</span>m2<span class="op">;</span></span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a>   fact <span class="op">=</span> mg<span class="op">/</span>len_3<span class="op">;</span></span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a>   f_part_k<span class="op">[</span>X<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a>   f_part_k<span class="op">[</span>Y<span class="op">]</span> <span class="op">*=</span> fact<span class="op">;</span></span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* Add force in to total forces */</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-81" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb351"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>   force1<span class="op">[</span>X<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>   force1<span class="op">[</span>Y<span class="op">]</span> <span class="op">+=</span> f_part_k<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>   force2<span class="op">[</span>X<span class="op">]</span> <span class="op">-=</span> f_part_k<span class="op">[</span>X<span class="op">];</span></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>   force2<span class="op">[</span>Y<span class="op">]</span> <span class="op">-=</span> f_part_k<span class="op">[</span>Y<span class="op">];</span></span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>  <span class="co">/* Compute_force_pair */</span></span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a><span class="co">/*---------------------------------------------------------------------</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-82" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb352"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Function<span class="op">:</span>  Update_part</span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Purpose<span class="op">:</span>   Update the velocity and position <span class="cf">for</span> particle loc_part</span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In args<span class="op">:</span></span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_part<span class="op">:</span>    local index of the particle we&#39;re updating</span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    masses<span class="op">:</span>      global array of particle masses</span>
<span id="cb352-6"><a href="#cb352-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_forces<span class="op">:</span>  local array of total forces</span>
<span id="cb352-7"><a href="#cb352-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    n<span class="op">:</span>           total number of particles</span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-83" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb353"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_n<span class="op">:</span>       number of particles assigned to this process</span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    delta_t<span class="op">:</span>     step size</span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> In<span class="op">/</span>out args<span class="op">:</span></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_pos<span class="op">:</span>     local array of positions</span>
<span id="cb353-6"><a href="#cb353-6" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    loc_vel<span class="op">:</span>     local array of velocities</span>
<span id="cb353-7"><a href="#cb353-7" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-84" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb354"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Note<span class="op">:</span>  This version uses Euler&#39;s method to update both the velocity</span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span>    and the position<span class="op">.</span></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Update_part<span class="op">(</span><span class="dt">int</span> loc_part<span class="op">,</span> <span class="dt">double</span> masses<span class="op">[],</span> vect_t loc_forces<span class="op">[],</span></span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>      vect_t loc_pos<span class="op">[],</span> vect_t loc_vel<span class="op">[],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> loc_n<span class="op">,</span></span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span> delta_t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> part<span class="op">;</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-85" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb355"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">double</span> fact<span class="op">;</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>   part <span class="op">=</span> my_rank<span class="op">*</span>loc_n <span class="op">+</span> loc_part<span class="op">;</span></span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a>   fact <span class="op">=</span> delta_t<span class="op">/</span>masses<span class="op">[</span>part<span class="op">];</span></span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Before update of %d:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> my_rank<span class="op">,</span> part<span class="op">);</span></span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Position  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-86" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb356"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>         loc_pos<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_pos<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Velocity  = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a>         loc_vel<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_vel<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;   Net force = (%.3e, %.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>         loc_forces<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_forces<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#  endif</span></span>
<span id="cb356-7"><a href="#cb356-7" aria-hidden="true" tabindex="-1"></a>   loc_pos<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> loc_vel<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">];</span></span></code></pre></div>
</section>
<section id="mpi-redukovana-forma-87" class="slide level2">
<h2>MPI Redukovana forma</h2>
<div class="sourceCode" id="cb357"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>   loc_pos<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> delta_t <span class="op">*</span> loc_vel<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">];</span></span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>   loc_vel<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> loc_forces<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">];</span></span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a>   loc_vel<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]</span> <span class="op">+=</span> fact <span class="op">*</span> loc_forces<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">];</span></span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#  ifdef DEBUG</span></span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;Proc %d &gt; Position of %d = (%.3e, %.3e), Velocity = (%.3e,%.3e)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a>         my_rank<span class="op">,</span> part<span class="op">,</span> loc_pos<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_pos<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">],</span></span>
<span id="cb357-7"><a href="#cb357-7" aria-hidden="true" tabindex="-1"></a>               loc_vel<span class="op">[</span>loc_part<span class="op">][</span>X<span class="op">],</span> loc_vel<span class="op">[</span>loc_part<span class="op">][</span>Y<span class="op">]);</span></span>
<span id="cb357-8"><a href="#cb357-8" aria-hidden="true" tabindex="-1"></a><span class="pp"># endif</span></span>
<span id="cb357-9"><a href="#cb357-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section></section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4//dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js@^4//plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/zoom/zoom.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/math/math.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: false,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [
          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
